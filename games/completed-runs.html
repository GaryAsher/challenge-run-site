---
layout: default
title: Completed Runs
---

{% assign game = site.games | where: "game_id", page.game_id | first %}
{% assign game_url = game.url | relative_url %}
{% assign back_url = game_url %}

<div class="page-width">
  <p class="muted page-back">
    <a href="{{ back_url }}">← {{ game.name | default: "Game" }}</a>
  </p>
</div>

<div class="game-shell">

  {% if game and game.cover %}
    <section
      class="game-hero"
      style="
        background-image: url('{{ game.cover | relative_url }}');
        background-position: {{ game.cover_position | default: 'center' }};
      "
    >
      <div class="game-hero__overlay">
        <div class="game-hero__content">
          <h1>{{ game.name }}</h1>
          <p class="muted">Completed Runs</p>
        </div>
      </div>
    </section>
  {% endif %}

  <nav class="runner-tabs game-tabs">
    <a class="tab" href="{{ game_url }}#challenges">Challenges</a>
    <a class="tab" href="{{ game_url }}#categories">Categories</a>
    <a class="tab active" href="{{ game_url }}completed-runs/">Completed Runs</a>
    <a class="tab" href="{{ game_url }}#resources">Resources</a>
    <a class="tab" href="{{ game_url }}#guides">Guides</a>
    <a class="tab" href="{{ game_url }}#forums">Forums</a>
    <a class="tab" href="{{ game_url }}#history">History</a>
  </nav>

  <section class="tab-panel active" style="display:block;">
    <div class="card">
      <h2>Completed Runs</h2>
      <p class="muted" id="runs-count"></p>

      <div style="margin: 0.5rem 0 0.75rem 0;">
        <label class="muted" for="runs-limit">Show:</label>
        <select id="runs-limit" class="select">
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="0">All</option>
        </select>
      </div>

      <div id="runs-list">
        {% if site.runs %}
          {% assign game_runs = site.runs | where: "game_id", game.game_id | sort: "date" | reverse %}
        {% else %}
          {% assign game_runs = empty %}
        {% endif %}

        {% for run in game_runs %}
          <article class="card run-item">
            <div class="muted" style="margin-bottom: 0.25rem;">
              {% if run.date %}{{ run.date }}{% endif %}
              {% if run.platform %}{% if run.date %} • {% endif %}{{ run.platform }}{% endif %}
            </div>

            <h3 style="margin: 0 0 0.35rem 0;">
              {{ run.title | default: run.category | default: "Run" }}
            </h3>

            <p class="muted" style="margin: 0 0 0.5rem 0;">
              {% if run.runner_name %}
                Runner:
                <a href="{{ '/runners/' | relative_url }}{{ run.runner_id | slugify }}/">
                  {{ run.runner_name }}
                </a>
              {% elsif run.runner_id %}
                Runner:
                <a href="{{ '/runners/' | relative_url }}{{ run.runner_id | slugify }}/">
                  {{ run.runner_id }}
                </a>
              {% endif %}

              {% if run.category %}
                {% if run.runner_id or run.runner_name %} • {% endif %}
                Category: {{ run.category }}
              {% endif %}

              {% if run.challenge %}
                • Challenge: {{ run.challenge }}
              {% endif %}
            </p>

            {% if run.video %}
              <p style="margin: 0;">
                <a href="{{ run.video }}" target="_blank" rel="noopener">Watch</a>
              </p>
            {% endif %}
          </article>
        {% endfor %}
      </div>

      <div class="pager" id="runs-pager" style="display:none; margin-top: 0.75rem;">
        <button class="btn" id="runs-prev" type="button">Prev</button>
        <span class="muted" id="runs-page" style="padding: 0 0.5rem;"></span>
        <button class="btn" id="runs-next" type="button">Next</button>
      </div>
    </div>
  </section>

</div>

<script>
(function () {
  const list = document.getElementById("runs-list");
  if (!list) return;

  const items = Array.from(list.querySelectorAll(".run-item"));
  const limitEl = document.getElementById("runs-limit");
  const countEl = document.getElementById("runs-count");

  const pager = document.getElementById("runs-pager");
  const prevBtn = document.getElementById("runs-prev");
  const nextBtn = document.getElementById("runs-next");
  const pageLabel = document.getElementById("runs-page");

  let page = 1;

  function getLimit() {
    const v = parseInt(limitEl.value, 10);
    return Number.isFinite(v) ? v : 10;
  }

  function render() {
    const limit = getLimit();
    const total = items.length;

    if (countEl) countEl.textContent = total === 1 ? "1 run" : `${total} runs`;

    if (limit === 0) {
      items.forEach(el => (el.style.display = ""));
      if (pager) pager.style.display = "none";
      return;
    }

    const pages = Math.max(1, Math.ceil(total / limit));
    if (page > pages) page = pages;

    const start = (page - 1) * limit;
    const end = start + limit;

    items.forEach((el, i) => {
      el.style.display = (i >= start && i < end) ? "" : "none";
    });

    if (pager) pager.style.display = pages > 1 ? "" : "none";
    if (pageLabel) pageLabel.textContent = `Page ${page} / ${pages}`;

    if (prevBtn) prevBtn.disabled = page <= 1;
    if (nextBtn) nextBtn.disabled = page >= pages;
  }

  if (prevBtn) prevBtn.addEventListener("click", () => { page -= 1; render(); });
  if (nextBtn) nextBtn.addEventListener("click", () => { page += 1; render(); });

  if (limitEl) {
    limitEl.addEventListener("change", () => {
      page = 1;
      render();
    });
  }

  render();
})();
</script>
