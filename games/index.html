---
layout: default
title: Games
---

<!-- =========================================================
     Page header + controls (constrained to page width)
     ========================================================= -->
<div class="page-width games-controls" id="games-controls">

  <h1>Games</h1>
  <p class="muted">Jump by letter or filter by platform, genre, and challenges.</p>

  <!-- A–Z navigation -->
  <div class="az" id="az">
    <a href="#0-9" class="az-wide">#</a>
    {% assign letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ" | split: "" %}
    {% for L in letters %}
      <a href="#{{ L }}">{{ L }}</a>
    {% endfor %}
    <a href="#other" class="az-wide">Other</a>
    <a href="#all" class="az-wide muted">All</a>
  </div>

  <!-- Text search -->
  <div class="filter-wrap" style="margin-bottom: 1.25rem;">
    <input
      id="q"
      class="filter"
      type="text"
      placeholder="Search by game name..."
      autocomplete="off"
      inputmode="search"
      enterkeyhint="search"
      aria-label="Search games"
    />
  </div>

  <!-- Platform + Genre + Challenges row -->
  <div class="filters-grid filters-grid--three">

    <!-- Platform filter -->
    <div class="tag-filter" id="platform-filter">
      <div class="muted filter-label">Filter by platform:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="platform-picked"></div>

        <div class="filter-wrap">
          <input
            id="platform-search"
            class="tag-search"
            type="text"
            placeholder="Type a platform..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by platform"
          />
        </div>

        <div class="tag-suggestions" id="platform-suggestions" hidden></div>
      </div>
    </div>

    <!-- Genre filter (was tags) -->
    <div class="tag-filter" id="genre-filter">
      <div class="muted filter-label">Filter by genre:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="genre-picked"></div>

        <div class="filter-wrap">
          <input
            id="genre-search"
            class="tag-search"
            type="text"
            placeholder="Type a genre..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by genre"
          />
        </div>

        <div class="tag-suggestions" id="genre-suggestions" hidden></div>
      </div>
    </div>

    <!-- Challenge filter -->
    <div class="tag-filter" id="challenge-filter">
      <div class="muted filter-label">Filter by challenges:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="challenge-picked"></div>

        <div class="filter-wrap">
          <input
            id="challenge-search"
            class="tag-search"
            type="text"
            placeholder="Type a challenge..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by challenge"
          />
        </div>

        <div class="tag-suggestions" id="challenge-suggestions" hidden></div>
      </div>
    </div>

  </div>

  <!-- Results controls bar -->
  <div class="results-bar">
    <div class="results-bar__left">
      <label class="muted" for="limit">Show</label>
      <select id="limit" class="select">
        <option value="10" selected>10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="250">250</option>
        <option value="0">All</option>
      </select>
    </div>
    <div class="results-bar__center">
      <p class="muted" id="status"></p>
    </div>
    <div class="results-bar__right">
      <button type="button" class="btn btn--reset" id="reset-all" hidden>Reset Filters</button>
    </div>
  </div>

</div>

<!-- =========================================================
     Games grid (constrained to page width)
     ========================================================= -->
<div class="page-width">
  <div class="grid" id="game-list">
    {% assign sorted = site.games | sort: "name" %}
    {% for g in sorted %}
      <a
        class="game-card game-item"
        href="{{ g.url | relative_url }}"
        data-name="{{ g.name | downcase }}"
        data-letter="{{ g.name | strip | slice: 0, 1 | upcase }}"
        data-genres="{{ g.tags | join: ',' | downcase }}"
        data-platforms="{{ g.platforms | default: empty | join: ',' | downcase }}"
        data-challenges="{{ g.challenges | default: empty | join: ',' | downcase }}"
      >
        {% assign game_cover = g.cover | default: "/assets/img/site/default-game.jpg" %}
        <div class="game-card__bg" style="background-image: url('{{ game_cover | relative_url }}');"></div>
        <div class="game-card__overlay">
          <div class="game-card__title">{{ g.name }}</div>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

<script>
// =========================================================
// DOM: cache everything once for speed + clarity
// =========================================================
const items = Array.from(document.querySelectorAll(".game-item"));
const input = document.getElementById("q");
const status = document.getElementById("status");
const limitSelect = document.getElementById("limit");
const resetBtn = document.getElementById("reset-all");

// =========================================================
// DOM: Filter elements - Genre (was tags), Platform, Challenge
// =========================================================
const genreFilterEl = document.getElementById("genre-filter");
const genrePickedEl = document.getElementById("genre-picked");
const genreSearchEl = document.getElementById("genre-search");
const genreSugEl = document.getElementById("genre-suggestions");

const platformFilterEl = document.getElementById("platform-filter");
const platformPickedEl = document.getElementById("platform-picked");
const platformSearchEl = document.getElementById("platform-search");
const platformSugEl = document.getElementById("platform-suggestions");

const challengeFilterEl = document.getElementById("challenge-filter");
const challengePickedEl = document.getElementById("challenge-picked");
const challengeSearchEl = document.getElementById("challenge-search");
const challengeSugEl = document.getElementById("challenge-suggestions");

const activeGenres = new Set();
const activePlatforms = new Set();
const activeChallenges = new Set();

// =========================================================
// Data: load label maps from Jekyll data files (safe via jsonify)
// =========================================================
const GENRES = [
{% for pair in site.data.tags %}
  {
    id: {{ pair[0] | jsonify }},
    label: {{ pair[1].label | default: pair[0] | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
].sort((a, b) => a.label.localeCompare(b.label));

const PLATFORMS = [
{% for pair in site.data.platforms %}
  {
    id: {{ pair[0] | jsonify }},
    label: {{ pair[1].label | default: pair[0] | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
].sort((a, b) => a.label.localeCompare(b.label));

const CHALLENGES = [
{% for pair in site.data.challenges %}
  {
    id: {{ pair[0] | jsonify }},
    label: {{ pair[1].label | default: pair[0] | jsonify }},
    aliases: {{ pair[1].aliases | default: empty | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
].sort((a, b) => a.label.localeCompare(b.label));

// =========================================================
// Normalize user input + IDs so matching is consistent
// =========================================================
const norm = s => (s || "").trim().toLowerCase();

// Convert roman numerals to arabic for matching
function expandRomanNumerals(s) {
  let str = norm(s);
  const romans = [
    ['viii', '8'], ['vii', '7'], ['vi', '6'], ['iv', '4'], ['v', '5'],
    ['iii', '3'], ['ii', '2'], ['i', '1'],
    ['xiii', '13'], ['xii', '12'], ['xi', '11'], ['x', '10'],
    ['xiv', '14'], ['xv', '15'], ['xvi', '16']
  ];
  romans.forEach(function(pair) {
    const regex = new RegExp('\\b' + pair[0] + '\\b', 'g');
    str = str.replace(regex, pair[1]);
  });
  return str;
}

// =========================================================
// UI helpers: picked chips + suggestions list
// =========================================================
function renderPicked(set, list, pickedEl, { onRemove } = {}) {
  pickedEl.innerHTML = "";

  const entries = Array.from(set);
  if (!entries.length) return;

  for (const id of entries) {
    const meta = list.find(x => norm(x.id) === norm(id));
    const label = meta ? meta.label : id;

    const chip = document.createElement("button");
    chip.type = "button";
    chip.className = "tag-chip";
    chip.textContent = `${label} ×`;

    chip.addEventListener("click", () => {
      set.delete(norm(id));
      if (onRemove) onRemove();
    });

    pickedEl.appendChild(chip);
  }
}

function renderSuggestions(qRaw, set, list, sugEl, { onPick } = {}) {
  const q = norm(qRaw);
  sugEl.innerHTML = "";

  const available = list.filter(x => !set.has(norm(x.id)));
  const filtered = q
    ? available.filter(x => {
        if (norm(x.label).includes(q) || norm(x.id).includes(q)) return true;
        if (x.aliases && x.aliases.length) {
          return x.aliases.some(alias => norm(alias).includes(q));
        }
        return false;
      })
    : available;

  const show = filtered.slice(0, 30);

  if (!show.length) {
    const empty = document.createElement("div");
    empty.className = "tag-suggestion is-empty";
    empty.textContent = "No matches.";
    sugEl.appendChild(empty);
    sugEl.hidden = false;
    return;
  }

  for (const item of show) {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "tag-suggestion";
    btn.textContent = item.label;

    btn.addEventListener("click", () => {
      set.add(norm(item.id));
      if (onPick) onPick(item);
    });

    sugEl.appendChild(btn);
  }

  sugEl.hidden = false;
}

// =========================================================
// Reset button visibility
// =========================================================
function updateResetButton() {
  const hasFilters = input.value.trim() ||
                     activeGenres.size > 0 ||
                     activePlatforms.size > 0 ||
                     activeChallenges.size > 0 ||
                     location.hash;
  if (resetBtn) resetBtn.hidden = !hasFilters;
}

function resetAllFilters() {
  input.value = '';
  activeGenres.clear();
  activePlatforms.clear();
  activeChallenges.clear();
  
  // Clear hash
  history.pushState('', document.title, window.location.pathname + window.location.search);
  
  // Re-render picked chips
  renderPicked(activeGenres, GENRES, genrePickedEl, { onRemove: () => {
    renderPicked(activeGenres, GENRES, genrePickedEl);
    applyFilter();
  }});
  renderPicked(activePlatforms, PLATFORMS, platformPickedEl, { onRemove: () => {
    renderPicked(activePlatforms, PLATFORMS, platformPickedEl);
    applyFilter();
  }});
  renderPicked(activeChallenges, CHALLENGES, challengePickedEl, { onRemove: () => {
    renderPicked(activeChallenges, CHALLENGES, challengePickedEl);
    applyFilter();
  }});
  
  updateAzActive();
  applyFilter();
}

if (resetBtn) {
  resetBtn.addEventListener('click', resetAllFilters);
}

// =========================================================
// Filtering: search + genres + platforms + challenges
// =========================================================
function applyFilter() {
  const q = norm(input.value);
  const qExpanded = expandRomanNumerals(input.value);
  const limit = Number(limitSelect.value);
  const matches = [];

  const rawHash = (location.hash || "").replace("#", "").toUpperCase();
  const hashMode = rawHash && rawHash !== "ALL" ? rawHash : "";

  for (const el of items) {
    const name = el.dataset.name || "";
    const nameExpanded = expandRomanNumerals(name);
    const genres = (el.dataset.genres || "").split(",").map(norm).filter(Boolean);
    const platforms = (el.dataset.platforms || "").split(",").map(norm).filter(Boolean);
    const challenges = (el.dataset.challenges || "").split(",").map(norm).filter(Boolean);

    const letter = (el.dataset.letter || "").toUpperCase();
    const startsWithDigit = letter >= "0" && letter <= "9";
    const startsWithAtoZ = letter >= "A" && letter <= "Z";

    const okHash =
      !hashMode ||
      (hashMode === "0-9" && startsWithDigit) ||
      (hashMode === "OTHER" && !startsWithDigit && !startsWithAtoZ) ||
      (hashMode.length === 1 && letter === hashMode);

    const nameMatch = !q || name.includes(q) || nameExpanded.includes(qExpanded);

    const ok =
      okHash &&
      nameMatch &&
      Array.from(activeGenres).every(g => genres.includes(g)) &&
      Array.from(activePlatforms).every(p => platforms.includes(p)) &&
      Array.from(activeChallenges).every(c => challenges.includes(c));

    if (ok) matches.push(el);
    el.style.display = "none";
  }

  const shown = limit === 0 ? matches.length : Math.min(limit, matches.length);
  for (let i = 0; i < shown; i++) matches[i].style.display = "";

  status.textContent = `Showing ${shown} of ${matches.length} games.`;
  updateResetButton();
}

// =========================================================
// Dropdown behavior: open on focus/click, close on outside/Esc
// =========================================================
function wireDropdown({ filterEl, searchEl, sugEl, set, list, pickedEl }) {
  function afterPick() {
    searchEl.value = "";
    renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });
    applyFilter();
    renderSuggestions("", set, list, sugEl, { onPick: afterPick });
  }

  function open() {
    renderSuggestions(searchEl.value, set, list, sugEl, { onPick: afterPick });
  }

  function close() {
    sugEl.hidden = true;
  }

  function onRemoveChip() {
    searchEl.value = "";
    renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });
    applyFilter();
    close();
  }

  renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });

  searchEl.addEventListener("focus", () => { if (sugEl.hidden) open(); });
  searchEl.addEventListener("pointerdown", () => { if (sugEl.hidden) open(); else close(); });
  searchEl.addEventListener("input", () => open());
  searchEl.addEventListener("keydown", (e) => { if (e.key === "Escape") { close(); searchEl.blur(); } });
  document.addEventListener("pointerdown", (e) => { if (!filterEl.contains(e.target)) close(); }, true);
}

// =========================================================
// Init dropdowns
// =========================================================
wireDropdown({
  filterEl: genreFilterEl,
  searchEl: genreSearchEl,
  sugEl: genreSugEl,
  set: activeGenres,
  list: GENRES,
  pickedEl: genrePickedEl
});

wireDropdown({
  filterEl: platformFilterEl,
  searchEl: platformSearchEl,
  sugEl: platformSugEl,
  set: activePlatforms,
  list: PLATFORMS,
  pickedEl: platformPickedEl
});

wireDropdown({
  filterEl: challengeFilterEl,
  searchEl: challengeSearchEl,
  sugEl: challengeSugEl,
  set: activeChallenges,
  list: CHALLENGES,
  pickedEl: challengePickedEl
});

// =========================================================
// A-Z Navigation: Update active state
// =========================================================
const azLinks = document.querySelectorAll('.az a');

function updateAzActive() {
  const hash = (location.hash || '').replace('#', '').toUpperCase();
  azLinks.forEach(link => {
    const linkHash = (link.getAttribute('href') || '').replace('#', '').toUpperCase();
    link.classList.toggle('is-active', linkHash === hash);
  });
}

window.addEventListener("hashchange", () => {
  updateAzActive();
  applyFilter();
});

azLinks.forEach(link => {
  link.addEventListener('click', () => {
    setTimeout(updateAzActive, 0);
  });
});

input.addEventListener("input", applyFilter);
limitSelect.addEventListener("change", applyFilter);

updateAzActive();
applyFilter();
</script>
