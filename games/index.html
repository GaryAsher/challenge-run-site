---
layout: default
title: Games
---

<!-- =========================================================
     Page header + controls (constrained to page width)
     ========================================================= -->
<div class="page-width games-controls" id="games-controls">

  <h1>Games</h1>
  <p class="muted">Jump by letter or filter by tags and challenges.</p>

  <!-- A–Z navigation -->
  <div class="az" id="az">
    <a href="#0-9" class="az-wide">#</a>
    {% assign letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ" | split: "" %}
    {% for L in letters %}
      <a href="#{{ L }}">{{ L }}</a>
    {% endfor %}
    <a href="#other" class="az-wide">Other</a>
    <a href="#all" class="az-wide muted">All</a>
  </div>

  <!-- Text search -->
  <div class="filter-wrap" style="margin-bottom: 1.25rem;">
    <input
      id="q"
      class="filter"
      type="text"
      placeholder="Search by game name..."
      autocomplete="off"
      inputmode="search"
      enterkeyhint="search"
      aria-label="Search games"
    />
  </div>

  <!-- Tags + Challenges row -->
  <div class="filters-grid">

    <!-- Tag filter -->
    <div class="tag-filter" id="tag-filter">
      <div class="muted filter-label">Filter by tags:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="tag-picked"></div>

        <div class="filter-wrap">
          <input
            id="tag-search"
            class="tag-search"
            type="text"
            placeholder="Type a tag..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by tag"
          />
        </div>

        <div class="tag-suggestions" id="tag-suggestions" hidden></div>
      </div>
    </div>

    <!-- Challenge filter -->
    <div class="tag-filter" id="challenge-filter">
      <div class="muted filter-label">Filter by challenges:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="challenge-picked"></div>

        <div class="filter-wrap">
          <input
            id="challenge-search"
            class="tag-search"
            type="text"
            placeholder="Type a challenge..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by challenge"
          />
        </div>

        <div class="tag-suggestions" id="challenge-suggestions" hidden></div>
      </div>
    </div>

  </div>

  <!-- Results controls -->
  <div class="results-controls">
    <label class="muted" for="limit">Show:</label>
    <select id="limit" class="select">
      <option value="10" selected>10</option>
      <option value="25">25</option>
      <option value="50">50</option>
      <option value="100">100</option>
      <option value="250">250</option>
      <option value="0">All</option>
    </select>
  </div>

  <p class="muted" id="status"></p>

</div>

<!-- =========================================================
     Games grid (constrained to page width)
     ========================================================= -->
<div class="page-width">
  <div class="grid" id="game-list">
    {% assign sorted = site.games | sort: "name" %}
    {% for g in sorted %}
      <a
        class="game-card game-item"
        href="{{ g.url | relative_url }}"
        data-name="{{ g.name | downcase }}"
        data-letter="{{ g.name | strip | slice: 0, 1 | upcase }}"
        data-tags="{{ g.tags | join: ',' | downcase }}"
        data-challenges="{{ g.challenges | default: empty | join: ',' | downcase }}"
      >
        {% assign game_cover = g.cover | default: "/assets/img/site/default-game.jpg" %}
        <div class="game-card__bg" style="background-image: url('{{ game_cover | relative_url }}');"></div>
        <div class="game-card__overlay">
          <div class="game-card__title">{{ g.name }}</div>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

<script>
// =========================================================
// DOM: cache everything once for speed + clarity
// =========================================================
const items = Array.from(document.querySelectorAll(".game-item"));
const input = document.getElementById("q");
const status = document.getElementById("status");
const limitSelect = document.getElementById("limit");

// =========================================================
// DOM: Tags filter elements + challenge filter elements
// =========================================================
const tagFilterEl = document.getElementById("tag-filter");
const tagPickedEl = document.getElementById("tag-picked");
const tagSearchEl = document.getElementById("tag-search");
const tagSugEl = document.getElementById("tag-suggestions");

const challengeFilterEl = document.getElementById("challenge-filter");
const challengePickedEl = document.getElementById("challenge-picked");
const challengeSearchEl = document.getElementById("challenge-search");
const challengeSugEl = document.getElementById("challenge-suggestions");

const activeTags = new Set();
const activeChallenges = new Set();

// =========================================================
// Data: load label maps from Jekyll data files (safe via jsonify)
// =========================================================
const TAGS = [
{% for pair in site.data.tags %}
  {
    id: {{ pair[0] | jsonify }},
    label: {{ pair[1].label | default: pair[0] | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
].sort((a, b) => a.label.localeCompare(b.label));

const CHALLENGES = [
{% for pair in site.data.challenges %}
  {
    id: {{ pair[0] | jsonify }},
    label: {{ pair[1].label | default: pair[0] | jsonify }}
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
].sort((a, b) => a.label.localeCompare(b.label));

// =========================================================
// Normalize user input + IDs so matching is consistent
// =========================================================
const norm = s => (s || "").trim().toLowerCase();

// =========================================================
// UI helpers: picked chips + suggestions list
// =========================================================
function renderPicked(set, list, pickedEl, { onRemove } = {}) {
  pickedEl.innerHTML = "";

  const entries = Array.from(set);
  if (!entries.length) return;

  for (const id of entries) {
    const meta = list.find(x => norm(x.id) === norm(id));
    const label = meta ? meta.label : id;

    const chip = document.createElement("button");
    chip.type = "button";
    chip.className = "tag-chip";
    chip.textContent = `${label} ×`;

    chip.addEventListener("click", () => {
      set.delete(norm(id));
      if (onRemove) onRemove();
    });

    pickedEl.appendChild(chip);
  }
}

function renderSuggestions(qRaw, set, list, sugEl, { onPick } = {}) {
  const q = norm(qRaw);
  sugEl.innerHTML = "";

  const available = list.filter(x => !set.has(norm(x.id)));
  const filtered = q
    ? available.filter(x => norm(x.label).includes(q) || norm(x.id).includes(q))
    : available;

  const show = filtered.slice(0, 30);

  if (!show.length) {
    const empty = document.createElement("div");
    empty.className = "tag-suggestion is-empty";
    empty.textContent = "No matches.";
    sugEl.appendChild(empty);
    sugEl.hidden = false;
    return;
  }

  for (const item of show) {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "tag-suggestion";
    btn.textContent = item.label;

    btn.addEventListener("click", () => {
      set.add(norm(item.id));
      if (onPick) onPick(item);
    });

    sugEl.appendChild(btn);
  }

  sugEl.hidden = false;
}

// =========================================================
// Filtering: search + tags + challenges
// =========================================================
function applyFilter() {
  const q = norm(input.value);
  const limit = Number(limitSelect.value);
  const matches = [];

  const rawHash = (location.hash || "").replace("#", "").toUpperCase();
  const hashMode = rawHash && rawHash !== "ALL" ? rawHash : "";

  for (const el of items) {
    const name = el.dataset.name || "";
    const tags = (el.dataset.tags || "").split(",").map(norm).filter(Boolean);
    const challenges = (el.dataset.challenges || "").split(",").map(norm).filter(Boolean);

    const letter = (el.dataset.letter || "").toUpperCase();
    const startsWithDigit = letter >= "0" && letter <= "9";
    const startsWithAtoZ = letter >= "A" && letter <= "Z";

    const okHash =
      !hashMode ||
      (hashMode === "0-9" && startsWithDigit) ||
      (hashMode === "OTHER" && !startsWithDigit && !startsWithAtoZ) ||
      (hashMode.length === 1 && letter === hashMode);

    const ok =
      okHash &&
      (!q || name.includes(q)) &&
      Array.from(activeTags).every(t => tags.includes(t)) &&
      Array.from(activeChallenges).every(c => challenges.includes(c));

    if (ok) matches.push(el);
    el.style.display = "none";
  }

  const shown = limit === 0 ? matches.length : Math.min(limit, matches.length);
  for (let i = 0; i < shown; i++) matches[i].style.display = "";

  status.textContent =
    `${shown} shown of ${matches.length} matches` +
    (hashMode ? ` (section: ${hashMode})` : "");
}

// =========================================================
// Dropdown behavior: open on focus/click, close on outside/Esc
// =========================================================
function wireDropdown({ filterEl, searchEl, sugEl, set, list, pickedEl }) {
  function afterPick() {
    searchEl.value = "";
    renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });
    applyFilter();

    // Keep the dropdown open for rapid multi-picking, but refresh it.
    renderSuggestions("", set, list, sugEl, { onPick: afterPick });
  }

  function open() {
    renderSuggestions(searchEl.value, set, list, sugEl, {
      onPick: afterPick
    });
  }

  function close() {
    sugEl.hidden = true;
  }

  function onRemoveChip() {
    searchEl.value = "";
    renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });
    applyFilter();
    close();
  }

  renderPicked(set, list, pickedEl, { onRemove: onRemoveChip });

  searchEl.addEventListener("focus", () => {
    if (sugEl.hidden) open();
  });

  searchEl.addEventListener("pointerdown", () => {
    if (sugEl.hidden) open();
    else close();
  });

  searchEl.addEventListener("input", () => open());

  searchEl.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      close();
      searchEl.blur();
    }
  });

  document.addEventListener("pointerdown", (e) => {
    if (!filterEl.contains(e.target)) close();
  }, true);
}

// =========================================================
// Init
// =========================================================
wireDropdown({
  filterEl: tagFilterEl,
  searchEl: tagSearchEl,
  sugEl: tagSugEl,
  set: activeTags,
  list: TAGS,
  pickedEl: tagPickedEl
});

wireDropdown({
  filterEl: challengeFilterEl,
  searchEl: challengeSearchEl,
  sugEl: challengeSugEl,
  set: activeChallenges,
  list: CHALLENGES,
  pickedEl: challengePickedEl
});

window.addEventListener("hashchange", applyFilter);
input.addEventListener("input", applyFilter);
limitSelect.addEventListener("change", applyFilter);

applyFilter();
</script>
