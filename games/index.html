---
layout: default
title: Games
---

<!-- =========================================================
     Page header + controls (constrained to page width)
     ========================================================= -->
<div class="page-width games-controls" id="games-controls">

  <h1>Games</h1>
  <p class="muted">Jump by letter or filter by platform, genre, and challenges.</p>

  <!-- Aâ€“Z navigation -->
  <div class="az" id="az">
    <a href="#0-9" class="az-wide">#</a>
    {% assign letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ" | split: "" %}
    {% for L in letters %}
      <a href="#{{ L }}">{{ L }}</a>
    {% endfor %}
    <a href="#other" class="az-wide">Other</a>
    <a href="#all" class="az-wide muted">All</a>
  </div>

  <!-- Text search -->
  <div class="filter-wrap" style="margin-bottom: 1.25rem;">
    <input
      id="q"
      class="filter"
      type="text"
      placeholder="Search by game name..."
      autocomplete="off"
      inputmode="search"
      enterkeyhint="search"
      aria-label="Search games"
    />
  </div>

  <!-- Platform + Genre + Challenges row -->
  <div class="filters-grid filters-grid--three">

    <!-- Platform filter -->
    <div class="tag-filter" id="platform-filter">
      <div class="muted filter-label">Filter by platform:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="platform-picked"></div>

        <div class="filter-wrap">
          <input
            id="platform-search"
            class="tag-search"
            type="text"
            placeholder="Type a platform..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by platform"
          />
        </div>

        <div class="tag-suggestions" id="platform-suggestions" hidden></div>
      </div>
    </div>

    <!-- Genre filter -->
    <div class="tag-filter" id="genre-filter">
      <div class="muted filter-label">Filter by genre:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="genre-picked"></div>

        <div class="filter-wrap">
          <input
            id="genre-search"
            class="tag-search"
            type="text"
            placeholder="Type a genre..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by genre"
          />
        </div>

        <div class="tag-suggestions" id="genre-suggestions" hidden></div>
      </div>
    </div>

    <!-- Challenge filter -->
    <div class="tag-filter" id="challenge-filter">
      <div class="muted filter-label">Filter by challenges:</div>

      <div class="tag-picker">
        <div class="tag-picked" id="challenge-picked"></div>

        <div class="filter-wrap">
          <input
            id="challenge-search"
            class="tag-search"
            type="text"
            placeholder="Type a challenge..."
            autocomplete="off"
            inputmode="search"
            enterkeyhint="done"
            aria-label="Filter games by challenge"
          />
        </div>

        <div class="tag-suggestions" id="challenge-suggestions" hidden></div>
      </div>
    </div>

  </div>

  <!-- Results controls bar -->
  <div class="results-bar">
    <div class="results-bar__left">
      <label class="muted" for="limit">Show</label>
      <select id="limit" class="select">
        <option value="10" selected>10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="250">250</option>
        <option value="0">All</option>
      </select>
    </div>
    <div class="results-bar__center">
      <p class="muted" id="status"></p>
    </div>
    <div class="results-bar__right">
      <button type="button" class="btn btn--reset" id="reset-all" hidden>Reset Filters</button>
    </div>
  </div>

</div>

<!-- =========================================================
     Games grid (constrained to page width)
     ========================================================= -->
<div class="page-width">
  <div class="grid" id="game-list">
    {% assign sorted = site.games | sort: "name" %}
    {% for g in sorted %}
      <a
        class="game-card game-item card-lift"
        href="{{ g.url | relative_url }}"
        data-name="{{ g.name | downcase }}"
        data-name-aliases="{% if g.game_name_aliases %}{{ g.game_name_aliases | join: ',' | downcase }}{% endif %}"
        data-letter="{{ g.name | strip | slice: 0, 1 | upcase }}"
        data-genres="{{ g.genres | join: ',' | downcase }}"
        data-platforms="{{ g.platforms | default: empty | join: ',' | downcase }}"
        data-challenges="{% for ch in g.challenges_data %}{{ ch.slug }}{% unless forloop.last %},{% endunless %}{% endfor %}"
      >
        {% assign game_cover = g.cover | default: "/assets/img/site/default-game.jpg" %}
        <div class="game-card__bg" style="background-image: url('{{ game_cover | relative_url }}');"></div>
        <div class="game-card__overlay">
          <div class="game-card__title">{{ g.name }}</div>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

<!-- Load shared filter utilities -->
<script src="{{ '/assets/js/filter-utils.js' | relative_url }}"></script>

<script>
(function() {
  'use strict';
  
  // =========================================================
  // Use shared utilities
  // =========================================================
  var F = window.CRCFilters;
  var norm = F.norm;
  var expandRomanNumerals = F.expandRomanNumerals;

  // =========================================================
  // DOM: cache everything once for speed + clarity
  // =========================================================
  var items = Array.from(document.querySelectorAll('.game-item'));
  var totalItems = items.length; // Store total count
  var input = document.getElementById('q');
  var status = document.getElementById('status');
  var limitSelect = document.getElementById('limit');
  var resetBtn = document.getElementById('reset-all');

  // =========================================================
  // DOM: Filter elements - Genre, Platform, Challenge
  // =========================================================
  var genreFilterEl = document.getElementById('genre-filter');
  var genrePickedEl = document.getElementById('genre-picked');
  var genreSearchEl = document.getElementById('genre-search');
  var genreSugEl = document.getElementById('genre-suggestions');

  var platformFilterEl = document.getElementById('platform-filter');
  var platformPickedEl = document.getElementById('platform-picked');
  var platformSearchEl = document.getElementById('platform-search');
  var platformSugEl = document.getElementById('platform-suggestions');

  var challengeFilterEl = document.getElementById('challenge-filter');
  var challengePickedEl = document.getElementById('challenge-picked');
  var challengeSearchEl = document.getElementById('challenge-search');
  var challengeSugEl = document.getElementById('challenge-suggestions');

  var activeGenres = new Set();
  var activePlatforms = new Set();
  var activeChallenges = new Set();

  // =========================================================
  // Data: load label maps from Jekyll data files (safe via jsonify)
  // =========================================================
  var GENRES = [
  {% for pair in site.data.genres %}
    {
      id: {{ pair[0] | jsonify }},
      label: {{ pair[1].label | default: pair[0] | jsonify }}
    }{% unless forloop.last %},{% endunless %}
  {% endfor %}
  ].sort(function(a, b) { return a.label.localeCompare(b.label); });

  var PLATFORMS = [
  {% for pair in site.data.platforms %}
    {
      id: {{ pair[0] | jsonify }},
      label: {{ pair[1].label | default: pair[0] | jsonify }},
      aliases: {{ pair[1].aliases | default: empty | jsonify }}
    }{% unless forloop.last %},{% endunless %}
  {% endfor %}
  ].sort(function(a, b) { return a.label.localeCompare(b.label); });

  var CHALLENGES = [
  {% for pair in site.data.challenges %}
    {
      id: {{ pair[0] | jsonify }},
      label: {{ pair[1].label | default: pair[0] | jsonify }},
      aliases: {{ pair[1].aliases | default: empty | jsonify }}
    }{% unless forloop.last %},{% endunless %}
  {% endfor %}
  ].sort(function(a, b) { return a.label.localeCompare(b.label); });

  // =========================================================
  // Reset button visibility
  // =========================================================
  function updateResetButton() {
    var hasFilters = input.value.trim() ||
                     activeGenres.size > 0 ||
                     activePlatforms.size > 0 ||
                     activeChallenges.size > 0 ||
                     location.hash;
    if (resetBtn) resetBtn.hidden = !hasFilters;
  }

  function resetAllFilters() {
    input.value = '';
    activeGenres.clear();
    activePlatforms.clear();
    activeChallenges.clear();
    
    // Clear hash
    history.pushState('', document.title, window.location.pathname + window.location.search);
    
    // Re-render picked chips
    F.renderPicked(activeGenres, GENRES, genrePickedEl, { onRemove: applyFilter });
    F.renderPicked(activePlatforms, PLATFORMS, platformPickedEl, { onRemove: applyFilter });
    F.renderPicked(activeChallenges, CHALLENGES, challengePickedEl, { onRemove: applyFilter });
    
    azNav.update();
    applyFilter();
  }

  if (resetBtn) {
    resetBtn.addEventListener('click', resetAllFilters);
  }

  // =========================================================
  // Filtering: search + genres + platforms + challenges
  // =========================================================
  function applyFilter() {
    var q = norm(input.value);
    var qExpanded = expandRomanNumerals(input.value);
    var limit = Number(limitSelect.value);
    var matches = [];

    var hashMode = F.getHashMode();

    for (var i = 0; i < items.length; i++) {
      var el = items[i];
      var name = el.dataset.name || '';
      var nameAliases = el.dataset.nameAliases || '';
      var nameExpanded = expandRomanNumerals(name);
      var genres = (el.dataset.genres || '').split(',').map(norm).filter(Boolean);
      var platforms = (el.dataset.platforms || '').split(',').map(norm).filter(Boolean);
      var challenges = (el.dataset.challenges || '').split(',').map(norm).filter(Boolean);

      var letter = (el.dataset.letter || '').toUpperCase();

      var okHash = F.matchesHashFilter(letter, hashMode);
      var nameMatch = !q || name.includes(q) || nameExpanded.includes(qExpanded) || nameAliases.includes(q);

      var okGenres = Array.from(activeGenres).every(function(g) { return genres.includes(g); });
      var okPlatforms = Array.from(activePlatforms).every(function(p) { return platforms.includes(p); });
      var okChallenges = Array.from(activeChallenges).every(function(c) { return challenges.includes(c); });

      var ok = okHash && nameMatch && okGenres && okPlatforms && okChallenges;

      if (ok) matches.push(el);
      el.style.display = 'none';
    }

    var shown = limit === 0 ? matches.length : Math.min(limit, matches.length);
    for (var j = 0; j < shown; j++) {
      matches[j].style.display = '';
    }

    // Fixed: Show "X of [total]" instead of "X of [filtered]"
    status.textContent = 'Showing ' + shown + ' of ' + totalItems + ' games.';
    updateResetButton();
  }

  // =========================================================
  // Init A-Z navigation
  // =========================================================
  var azNav = F.initAzNav({
    onHashChange: applyFilter
  });

  // =========================================================
  // Init dropdowns using shared utilities
  // =========================================================
  F.wireDropdown({
    filterEl: genreFilterEl,
    searchEl: genreSearchEl,
    sugEl: genreSugEl,
    set: activeGenres,
    list: GENRES,
    pickedEl: genrePickedEl,
    onFilter: applyFilter
  });

  F.wireDropdown({
    filterEl: platformFilterEl,
    searchEl: platformSearchEl,
    sugEl: platformSugEl,
    set: activePlatforms,
    list: PLATFORMS,
    pickedEl: platformPickedEl,
    onFilter: applyFilter
  });

  F.wireDropdown({
    filterEl: challengeFilterEl,
    searchEl: challengeSearchEl,
    sugEl: challengeSugEl,
    set: activeChallenges,
    list: CHALLENGES,
    pickedEl: challengePickedEl,
    onFilter: applyFilter
  });

  // =========================================================
  // Event listeners
  // =========================================================
  input.addEventListener('input', applyFilter);
  limitSelect.addEventListener('change', applyFilter);

  // Initial render
  applyFilter();
})();
</script>
