---
layout: default
title: Games
---

<h1>Games</h1>
<p class="muted">Jump by letter or filter by category.</p>

<div class="az" id="az">
  <a href="#0-9">#</a>

  {% assign letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ" | split: "" %}
  {% for L in letters %}
    <a href="#{{ L }}">{{ L }}</a>
  {% endfor %}

  <a href="#other">Other</a>
  <a href="#all" class="muted">All</a>
</div>

<div class="filter-wrap">
  <input
    id="q"
    class="filter"
    placeholder="Search within results..."
    autocomplete="off"
  />
</div>

<div class="tag-filter" id="tag-filter">
  <div class="muted" style="margin-bottom: 0.35rem;">Filter by tags:</div>

  <div class="tag-picker">
    <div class="tag-picked" id="tag-picked"></div>

    <div class="filter-wrap">
      <input
        id="tag-search"
        class="tag-search"
        type="text"
        placeholder="Type a tag (ex: Roguelike) ..."
        autocomplete="off"
        aria-label="Filter games by tags"
      />
    </div>

    <div class="tag-suggestions" id="tag-suggestions" hidden></div>
  </div>

  <p class="muted" style="margin: 0.4rem 0 0 0;">
    Tip: click a selected tag chip to remove it.
  </p>
</div>

<div class="results-controls">
  <label class="muted" for="limit">Show:</label>
  <select id="limit" class="select">
    <option value="10" selected>10</option>
    <option value="25">25</option>
    <option value="50">50</option>
    <option value="100">100</option>
    <option value="250">250</option>
    <option value="0">All</option>
  </select>
</div>

<p class="muted" id="status"></p>

<div class="grid" id="game-list">
  {% assign sorted = site.games | sort: "name" %}
  {% for g in sorted %}
    <a
      class="game-card game-item"
      href="{{ g.url | relative_url }}"
      data-name="{{ g.name | downcase }}"
      data-tags="{{ g.tags | join: ',' | downcase }}"
      aria-label="{{ g.name }}"
    >
      {% assign game_cover = g.cover | default: "/assets/img/site/default-game.jpg" %}

      <div
        class="game-card__bg"
        style="background-image: url('{{ game_cover | relative_url }}');"
      ></div>

      <div class="game-card__overlay">
        <div class="game-card__title">{{ g.name }}</div>
      </div>
    </a>
  {% endfor %}
</div>

<script>
  // =========================================================
  // DOM
  // =========================================================
  const items = Array.from(document.querySelectorAll(".game-item"));
  const input = document.getElementById("q");

  function focusEndOnWrap(inputEl) {
    const wrap = inputEl.closest(".filter-wrap");
    if (!wrap) return;

    wrap.addEventListener("pointerdown", (e) => {
      if (e.target !== inputEl) {
        e.preventDefault();
        inputEl.focus();
        const len = inputEl.value.length;
        inputEl.setSelectionRange(len, len);
      }
    });
    }

  focusEndOnWrap(input);

  const status = document.getElementById("status");
  const limitSelect = document.getElementById("limit");

  // Tag picker DOM
  const tagFilterEl = document.getElementById("tag-filter");
  const pickerEl = document.querySelector(".tag-picker");
  const pickedEl = document.getElementById("tag-picked");
  const searchEl = document.getElementById("tag-search");
  const sugEl = document.getElementById("tag-suggestions");

  focusEndOnWrap(searchEl);
  
  // =========================================================
  // Data
  // =========================================================
  const activeTags = new Set();

  const TAGS = [
    {% for pair in site.data.tags %}
      {% assign id = pair[0] %}
      {% assign meta = pair[1] %}
      { id: "{{ id | escape }}", label: "{{ meta.label | escape }}" }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  function norm(s) {
    return (s || "").trim().toLowerCase();
  }

  // =========================================================
  // Suggestions UI
  // =========================================================
  function openSuggestions() {
    sugEl.hidden = false;
  }

  function closeSuggestions() {
    sugEl.hidden = true;
  }

  function renderPicked() {
    pickedEl.innerHTML = "";

    for (const id of activeTags) {
      const meta = TAGS.find(t => norm(t.id) === id);
      const label = meta ? meta.label : id;

      const chip = document.createElement("button");
      chip.type = "button";
      chip.className = "tag-chip";
      chip.textContent = label;

      chip.addEventListener("click", () => {
        activeTags.delete(id);
        renderPicked();
        closeSuggestions();
        searchEl.blur();
      });

      pickedEl.appendChild(chip);
    }

    pickedEl.classList.toggle("is-empty", activeTags.size === 0);
  }

  function renderSuggestions(query) {
    const q = norm(query);
    sugEl.innerHTML = "";

    const results = TAGS
      .filter(t => {
        const id = norm(t.id);
        const label = norm(t.label);
        if (activeTags.has(id)) return false;
        if (!q) return true;
        return id.includes(q) || label.includes(q);
      })
      .slice(0, 24);

    if (results.length === 0) {
      const empty = document.createElement("div");
      empty.className = "tag-suggestion is-empty";
      empty.textContent = "No matching tags.";
      sugEl.appendChild(empty);
      openSuggestions();
      return;
    }

    for (const t of results) {
      const row = document.createElement("button");
      row.type = "button";
      row.className = "tag-suggestion";
      row.textContent = t.label;

      row.addEventListener("click", () => {
        activeTags.add(norm(t.id));
        searchEl.value = "";
        renderPicked();
        applyFilter();

        closeSuggestions();
        searchEl.blur();
      });

      sugEl.appendChild(row);
    }

    openSuggestions();
  }

  // =========================================================
  // Game filtering
  // =========================================================
  function classifyFirstChar(ch) {
    if (!ch) return "other";
    const upper = ch.toUpperCase();
    if (upper >= "A" && upper <= "Z") return upper;
    if (ch >= "0" && ch <= "9") return "0-9";
    return "other";
  }

  function getFirstChar(el) {
    const text = (el.textContent || "").trim();
    return text ? text[0] : "";
  }

  function applyFilter() {
    const bucket = ((location.hash || "#all").slice(1)) || "all";
    const q = norm(input.value);
    const limit = Number(limitSelect.value);

    const matches = [];

    for (const el of items) {
      const name = el.dataset.name || "";
      const group = classifyFirstChar(getFirstChar(el));

      const tags = (el.dataset.tags || "")
        .split(",")
        .map(s => norm(s))
        .filter(Boolean);

      const matchesTags =
        activeTags.size === 0 ||
        Array.from(activeTags).every(t => tags.includes(t));

      const matchesBucket = (bucket === "all" || bucket === group);
      const matchesQuery = (!q || name.includes(q));

      if (matchesBucket && matchesQuery && matchesTags) {
        matches.push(el);
      }
    }

    for (const el of items) el.style.display = "none";

    const count = limit === 0 ? matches.length : Math.min(limit, matches.length);
    for (let i = 0; i < count; i++) matches[i].style.display = "";

    const bucketLabel =
      bucket === "all" ? "All" :
      bucket === "0-9" ? "0â€“9" :
      bucket === "other" ? "Other" :
      bucket;

    const tagLabel =
      activeTags.size === 0 ? "Any tag" : `Tags: ${Array.from(activeTags).join(", ")}`;

    status.textContent =
      `${count} shown of ${matches.length} matches (filter: ${bucketLabel}, ${tagLabel})`;
  }

// =========================================================
// Events
// =========================================================

searchEl.addEventListener("input", () => renderSuggestions(searchEl.value));

searchEl.addEventListener("pointerdown", (e) => {
  if (!sugEl.hidden) {
    e.preventDefault();
    closeSuggestions();
    searchEl.blur();
  }
});

searchEl.addEventListener("focus", () => {
  if (sugEl.hidden) renderSuggestions(searchEl.value);
});

pickerEl.addEventListener("pointerdown", (e) => {
  const clickedInput = (e.target === searchEl);
  const clickedSuggestions = sugEl.contains(e.target);
  if (!clickedInput && !clickedSuggestions) e.preventDefault();
});

// Close suggestions when clicking outside
document.addEventListener("pointerdown", (e) => {
  if (!tagFilterEl.contains(e.target)) closeSuggestions();
}, true);

// Close suggestions on Escape
searchEl.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    closeSuggestions();
    searchEl.blur();
  }
});

window.addEventListener("hashchange", applyFilter);
input.addEventListener("input", applyFilter);
limitSelect.addEventListener("change", applyFilter);

  // =========================================================
  // Init
  // =========================================================
  renderPicked();
  applyFilter();
</script>
