---
layout: default
---

{% include game-header-tabs.html game=page active="overview" %}

<!-- =========================================================
     Overview Tab - Clean with accordions

     ORDERING (per spec):
     1. Game Description (content) - or placeholder if empty
     2. General Rules (default + game-specific)
     3. Challenges
     4. Optional Restrictions
     5. Glitch Categories
     6. Credits (if present)
     ========================================================= -->
<div class="page-width">
  <div class="game-shell">

    <section class="tab-panel active" data-panel="overview">

      <!-- =========================================================
           1. Game Description
           ========================================================= -->
      {% assign stripped_content = content | strip %}
      {% assign is_placeholder = false %}
      {% if stripped_content == "" or stripped_content contains "Game submitted via form" or stripped_content contains "Awaiting review" %}
        {% assign is_placeholder = true %}
      {% endif %}

      {% if is_placeholder %}
        <div class="card">
          <p class="muted"><em>üìù Game description needed. Want to help? <a href="{{ page.url | relative_url }}resources/">Visit the Resources tab</a> to learn how to contribute.</em></p>
        </div>
      {% elsif stripped_content != "" %}
        <div class="card">
          {{ content }}
        </div>
      {% endif %}

      <!-- =========================================================
           2. General Rules
           ========================================================= -->
      <div class="card card--compact mt-4" data-section-order="1">
        <h2 class="mb-2">General Rules</h2>

        {% if page.general_rules and page.general_rules.size > 0 %}
          <p class="muted mb-3">Core rules that apply to all {{ page.game_name }} runs:</p>
          <div class="md">
            {{ page.general_rules | markdownify }}
          </div>
        {% elsif site.data.default-rules.general_rules %}
          {% comment %} Fall back to global default-rules {% endcomment %}
          <p class="muted mb-3">Core rules that apply to all runs:</p>
          <div class="md">
            {{ site.data.default-rules.general_rules | markdownify }}
          </div>
        {% else %}
          <p class="muted mb-3">Core rules that apply to all runs:</p>
          <ul>
            <li><strong>Timing Method:</strong> {{ page.timing_method | default: "RTA (Real Time Attack)" }}</li>
            <li><strong>Video Required:</strong> All submissions must include video proof</li>
            <li><strong>No Cheats/Mods:</strong> External tools or gameplay-altering mods are not allowed</li>
          </ul>
        {% endif %}
      </div>

      <!-- =========================================================
           3. Challenges
           ========================================================= -->
      {% if page.challenges_data and page.challenges_data.size > 0 %}
        <div class="card card--compact mt-4" data-section-order="2">
          <h2 class="mb-2">Challenges</h2>
          <p class="muted mb-3">Challenges tracked for this game:</p>
          <div class="accordion">
            {% for ch in page.challenges_data %}
              <!-- If the game's challenge has no description, fall back to global _data/challenges.yml -->
              {% assign ch_desc = ch.description %}
              {% if ch_desc == nil or ch_desc == "" or ch_desc == blank %}
                {% assign global_challenge = site.data.challenges[ch.slug] %}
                {% if global_challenge and global_challenge.description %}
                  {% assign ch_desc = global_challenge.description %}
                {% endif %}
              {% endif %}
              
              <details class="accordion-item">
                <summary class="accordion-header">
                  <span class="accordion-title">{{ ch.label }}</span>
                  <span class="accordion-icon">‚ñº</span>
                </summary>
                <div class="accordion-content">
                  {% if ch_desc and ch_desc != "" and ch_desc != blank %}
                    <div class="md">
                      {{ ch_desc | markdownify }}
                    </div>
                  {% else %}
                    <p class="muted">No specific rules defined for this challenge type.</p>
                  {% endif %}
                </div>
              </details>
            {% endfor %}
          </div>
        </div>
      {% elsif page.challenges and page.challenges.size > 0 %}
        <!-- Fallback to old format if challenges_data not present -->
        <div class="card card--compact mt-4" data-section-order="2">
          <h2 class="mb-2">Standard Challenges</h2>
          <p class="muted mb-3">Challenge types tracked for this game:</p>
          <div class="accordion">
            {% for ch_id in page.challenges %}
              {% assign ch_meta = site.data.challenges[ch_id] %}
              <details class="accordion-item">
                <summary class="accordion-header">
                  <span class="accordion-title">{{ ch_meta.label | default: ch_id }}</span>
                  <span class="accordion-icon">‚ñº</span>
                </summary>
                <div class="accordion-content">
                  {% if ch_meta.description %}
                    <div class="md">
                      {{ ch_meta.description | markdownify }}
                    </div>
                  {% else %}
                    <p class="muted">See Rules tab for detailed definition.</p>
                  {% endif %}
                </div>
              </details>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <!-- =========================================================
           4. Optional Restrictions
           ========================================================= -->
      {% if page.restrictions_data and page.restrictions_data.size > 0 %}
        <div class="card card--compact mt-4" data-section-order="3">
          <h2 class="mb-2">Optional Restrictions</h2>
          <p class="muted mb-3">Additional restrictions runners can apply:</p>
          <div class="accordion">
            {% for res in page.restrictions_data %}
              <details class="accordion-item">
                <summary class="accordion-header">
                  <span class="accordion-title">{{ res.label }}</span>
                  <span class="accordion-icon">‚ñº</span>
                </summary>
                <div class="accordion-content">
                  {% if res.description %}
                    <div class="md">
                      {{ res.description | markdownify }}
                    </div>
                  {% else %}
                    <p class="muted">Can be combined with any category.</p>
                  {% endif %}
                  {% if res.incompatible_with and res.incompatible_with.size > 0 %}
                    <p class="mt-2 muted"><em>‚ö†Ô∏è Cannot be combined with: {{ res.incompatible_with | join: ", " }}</em></p>
                  {% endif %}
                </div>
              </details>
            {% endfor %}
          </div>
        </div>
      {% elsif page.restrictions and page.restrictions.size > 0 %}
        <!-- Fallback to old format -->
        <div class="card card--compact mt-4" data-section-order="3">
          <h2 class="mb-2">Optional Restrictions</h2>
          <p class="muted mb-3">Additional restrictions runners can apply:</p>
          <div class="accordion">
            {% for res in page.restrictions %}
              <details class="accordion-item">
                <summary class="accordion-header">
                  <span class="accordion-title">{{ res }}</span>
                  <span class="accordion-icon">‚ñº</span>
                </summary>
                <div class="accordion-content">
                  <p class="muted">Can be combined with any category.</p>
                </div>
              </details>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <!-- =========================================================
           5. Glitch Categories
           ========================================================= -->
      {% unless page.glitches_relevant == false %}
        {% if page.glitches_data and page.glitches_data.size > 0 %}
          <div class="card card--compact mt-4" data-section-order="4">
            <h2 class="mb-2">Glitch Categories</h2>
            <p class="muted mb-3">Rules for glitches and exploits in runs:</p>
            <div class="accordion">
              {% for gl in page.glitches_data %}
                <!-- If the game's glitch has no description, fall back to global _data/default-rules.yml -->
                {% assign gl_desc = gl.description %}
                {% if gl_desc == nil or gl_desc == "" or gl_desc == blank %}
                  {% assign global_glitch = site.data.default-rules.glitches[gl.slug] %}
                  {% if global_glitch and global_glitch.description %}
                    {% assign gl_desc = global_glitch.description %}
                  {% endif %}
                {% endif %}
                
                <details class="accordion-item">
                  <summary class="accordion-header">
                    <span class="accordion-title">{{ gl.label }}</span>
                    <span class="accordion-icon">‚ñº</span>
                  </summary>
                  <div class="accordion-content">
                    {% if gl_desc and gl_desc != "" and gl_desc != blank %}
                      <div class="md">
                        {{ gl_desc | markdownify }}
                      </div>
                    {% else %}
                      <p class="muted">No specific rules defined for this glitch category.</p>
                    {% endif %}
                    {% if gl.allowed and gl.allowed.size > 0 %}
                      <p class="mt-2"><strong>Allowed:</strong> {{ gl.allowed | join: ", " }}</p>
                    {% endif %}
                    {% if gl.banned and gl.banned.size > 0 %}
                      <p class="mt-2"><strong>Banned:</strong> {{ gl.banned | join: ", " }}</p>
                    {% endif %}
                    {% if gl.notes %}
                      <p class="mt-2 muted"><em>{{ gl.notes }}</em></p>
                    {% endif %}
                  </div>
                </details>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% else %}
        <!-- Glitches not relevant for this game - show notice -->
        <div class="card card--compact mt-4" data-section-order="4">
          <h2 class="mb-2">Glitch Categories</h2>
          <p class="muted">This game does not distinguish between glitch categories. All runs are accepted regardless of glitch usage.</p>
        </div>
      {% endunless %}

      <!-- =========================================================
           6. Credits
           ========================================================= -->
      <div class="card card--compact mt-4" data-section-order="5">
        <h2 class="mb-2">Credits</h2>
        {% if page.credits and page.credits.size > 0 %}
          <p class="muted mb-3">Contributors who helped establish this game's challenge run definitions:</p>
          <ul class="credits-list">
            {% for credit in page.credits %}
              <li>
                {% if credit.url %}
                  <a href="{{ credit.url }}" target="_blank" rel="noopener">{{ credit.name }}</a>
                {% else %}
                  {{ credit.name }}
                {% endif %}
                {% if credit.role %}<span class="muted"> ‚Äî {{ credit.role }}</span>{% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="muted">No credits listed yet.</p>
        {% endif %}
      </div>

      <!-- =========================================================
           7. Community Achievements
           ========================================================= -->
      {% if page.community_achievements and page.community_achievements.size > 0 %}
        <div class="card card--compact mt-4" data-section-order="6">
          <h2 class="mb-2">üèÜ Community Achievements</h2>
          <p class="muted mb-3">Community-defined challenges tracked for this game.</p>
          
          {% comment %} Get all achievement completions for this game {% endcomment %}
          {% assign game_completions = "" | split: "" %}
          {% for ac in site.achievements %}
            {% if ac.game_id == page.game_id %}
              {% assign game_completions = game_completions | push: ac %}
            {% endif %}
          {% endfor %}
          
          <div class="community-achievements-game">
            {% for ach in page.community_achievements %}
              {% comment %} Count completions for this specific achievement {% endcomment %}
              {% assign ach_completions = "" | split: "" %}
              {% assign ach_in_progress = "" | split: "" %}
              {% for comp in game_completions %}
                {% if comp.achievement_slug == ach.slug %}
                  {% if comp.date_completed and comp.date_completed != "" %}
                    {% assign ach_completions = ach_completions | push: comp %}
                  {% else %}
                    {% assign ach_in_progress = ach_in_progress | push: comp %}
                  {% endif %}
                {% endif %}
              {% endfor %}
              {% assign completed_count = ach_completions.size %}
              {% assign in_progress_count = ach_in_progress.size %}
              {% assign total_tracking = completed_count | plus: in_progress_count %}
              
              <details class="achievement-game-item">
                <summary class="achievement-game-header">
                  <div class="achievement-game-header__left">
                    <span class="achievement-game-icon">{{ ach.icon | default: 'üèÜ' }}</span>
                    <div class="achievement-game-info">
                      <h3 class="achievement-game-title">{{ ach.title }}</h3>
                      <p class="achievement-game-desc">{{ ach.description }}</p>
                    </div>
                  </div>
                  <div class="achievement-game-header__right">
                    {% if ach.difficulty %}
                      <span class="difficulty difficulty--{{ ach.difficulty }}">{{ ach.difficulty | capitalize }}</span>
                    {% endif %}
                    <span class="achievement-game-stat">
                      <span class="achievement-game-stat__completed">{{ completed_count }} completed</span>
                      {% if in_progress_count > 0 %}
                        <span class="achievement-game-stat__progress">{{ in_progress_count }} in progress</span>
                      {% endif %}
                    </span>
                    <span class="accordion-icon">‚ñº</span>
                  </div>
                </summary>
                <div class="achievement-game-content">
                  {% if ach.requirements and ach.requirements.size > 0 %}
                    <div class="achievement-game-requirements">
                      <h4>Requirements</h4>
                      <ul>
                        {% for req in ach.requirements %}
                          <li>{{ req }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                  
                  {% if total_tracking > 0 %}
                    <div class="achievement-game-runners">
                      <h4>Runner Progress</h4>
                      <div class="achievement-runners-list">
                        {% comment %} Show completed runners first, sorted by date {% endcomment %}
                        {% assign sorted_completions = ach_completions | sort: "date_completed" %}
                        {% for comp in sorted_completions %}
                          {% assign runner = site.runners | where: "runner_id", comp.runner_id | first %}
                          {% assign runner_name = runner.runner_name | default: comp.runner_id %}
                          {% assign runner_avatar = runner.avatar | default: "/assets/img/site/default-runner.png" %}
                          <div class="achievement-runner-row achievement-runner-row--completed">
                            <a href="{{ runner.url | relative_url }}" class="achievement-runner-info">
                              <div class="achievement-runner-avatar" style="background-image: url('{{ runner_avatar | relative_url }}')"></div>
                              <span class="achievement-runner-name">{{ runner_name }}</span>
                            </a>
                            <div class="achievement-runner-progress">
                              <div class="progress-bar progress-bar--full">
                                <div class="progress-bar__fill" style="width: 100%"></div>
                              </div>
                              <span class="progress-bar__text">{{ ach.total_required | default: "?" }} / {{ ach.total_required | default: "?" }}</span>
                            </div>
                            <div class="achievement-runner-status">
                              <span class="achievement-status-badge achievement-status-badge--completed">‚úì Completed</span>
                              <span class="achievement-runner-date">{{ comp.date_completed }}</span>
                            </div>
                            {% if comp.proof_url and comp.proof_url != "" %}
                              <a href="{{ comp.proof_url }}" target="_blank" rel="noopener" class="btn btn--small">‚ñ∂ Proof</a>
                            {% endif %}
                          </div>
                        {% endfor %}
                        
                        {% comment %} Show in-progress runners {% endcomment %}
                        {% assign sorted_progress = ach_in_progress | sort: "current_progress" | reverse %}
                        {% for comp in sorted_progress %}
                          {% assign runner = site.runners | where: "runner_id", comp.runner_id | first %}
                          {% assign runner_name = runner.runner_name | default: comp.runner_id %}
                          {% assign runner_avatar = runner.avatar | default: "/assets/img/site/default-runner.png" %}
                          {% assign current = comp.current_progress | default: 0 %}
                          {% assign total = ach.total_required | default: 1 %}
                          {% assign percent = current | times: 100 | divided_by: total %}
                          <div class="achievement-runner-row achievement-runner-row--progress">
                            <a href="{{ runner.url | relative_url }}" class="achievement-runner-info">
                              <div class="achievement-runner-avatar" style="background-image: url('{{ runner_avatar | relative_url }}')"></div>
                              <span class="achievement-runner-name">{{ runner_name }}</span>
                            </a>
                            <div class="achievement-runner-progress">
                              <div class="progress-bar">
                                <div class="progress-bar__fill" style="width: {{ percent }}%"></div>
                              </div>
                              <span class="progress-bar__text">{{ current }} / {{ total }}</span>
                            </div>
                            <div class="achievement-runner-status">
                              <span class="achievement-status-badge achievement-status-badge--progress">In Progress</span>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  {% else %}
                    <div class="achievement-game-empty">
                      <p class="muted">No runners tracking this achievement yet. Be the first!</p>
                    </div>
                  {% endif %}
                </div>
              </details>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </section>

  </div>
</div>
