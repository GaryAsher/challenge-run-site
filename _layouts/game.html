---
layout: default
---

<!-- =========================================================
     Back link to the Games index
     ========================================================= -->
<div class="page-width">
  <p class="muted page-back">
    <a href="{{ '/games/' | relative_url }}">← Games</a>
  </p>
</div>

<!-- =========================================================
     Game hero section (uses cover image if provided)
     ========================================================= -->
{% if page.cover %}
  <section
    class="game-hero"
    style="
      background-image: url('{{ page.cover | relative_url }}');
      background-position: {{ page.cover_position | default: 'center' }};
    "
  >
    <!-- Dark gradient overlay on top of the cover -->
    <div class="game-hero__overlay">
      <div class="game-hero__content">
        <h1>{{ page.name }}</h1>

        {% if page.status %}
          <p class="muted">{{ page.status }}</p>
        {% endif %}

        {% if page.tags and page.tags.size > 0 %}
          <div class="game-tags">
            {% for tag in page.tags %}
              {% assign meta = site.data.tags[tag] %}
              <span class="tag">{{ meta.label | default: tag }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </section>

{% else %}
  <!-- =========================================================
       Fallback layout if no cover image exists
       ========================================================= -->
  <div class="container">
    <h1>{{ page.name }}</h1>

    {% if page.status %}
      <p class="muted">{{ page.status }}</p>
    {% endif %}

    {% if page.tags and page.tags.size > 0 %}
      <div class="game-tags">
        {% for tag in page.tags %}
          {% assign meta = site.data.tags[tag] %}
          <span class="tag">{{ meta.label | default: tag }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endif %}

<!-- =========================================================
     Game Tabs - Main
     ========================================================= -->
{% assign tabs_cfg = page.tabs | default: {} %}
{% assign show_challenges = tabs_cfg.challenges | default: true %}
{% assign show_categories = tabs_cfg.categories | default: true %}
{% assign show_runs       = tabs_cfg.runs       | default: true %}
{% assign show_resources  = tabs_cfg.resources  | default: true %}
{% assign show_guides     = tabs_cfg.guides     | default: true %}
{% assign show_forums     = tabs_cfg.forums     | default: true %}
{% assign show_history    = tabs_cfg.history    | default: true %}

{% assign any_tabs = show_challenges or show_categories or show_runs or show_resources or show_guides or show_forums or show_history %}

{% if any_tabs %}
  <nav class="runner-tabs game-tabs" id="game-tabs">
    {% if show_challenges %}
      <button class="tab active" type="button" data-tab="challenges">Challenges</button>
    {% endif %}

    {% if show_categories %}
      <button class="tab" type="button" data-tab="categories">Categories</button>
    {% endif %}

    {% if show_runs %}
      <button class="tab" type="button" data-tab="runs">Completed Runs</button>
    {% endif %}

    {% if show_resources %}
      <button class="tab" type="button" data-tab="resources">Resources</button>
    {% endif %}

    {% if show_guides %}
      <button class="tab" type="button" data-tab="guides">Guides</button>
    {% endif %}

    {% if show_forums %}
      <button class="tab" type="button" data-tab="forums">Forums</button>
    {% endif %}

    {% if show_history %}
      <button class="tab" type="button" data-tab="history">History</button>
    {% endif %}
  </nav>

  <div class="page-width">

    <!-- =======================================================
         CHALLENGES
         ======================================================= -->
    {% if show_challenges %}
      <section class="tab-panel active" data-panel="challenges">
        <div class="card">
          <h2>Challenges</h2>

          {% if page.challenges and page.challenges.size > 0 %}
            <div class="game-tags">
              {% for challenge in page.challenges %}
                {% assign meta = site.data.challenges[challenge] %}
                <span class="tag">{{ meta.label | default: challenge }}</span>
              {% endfor %}
            </div>
          {% else %}
            <p class="muted">No challenges listed yet.</p>
          {% endif %}
        </div>

        {% if content and content != "" %}
          <div class="card">
            {{ content }}
          </div>
        {% endif %}
      </section>
    {% endif %}

    <!-- =======================================================
         CATEGORIES
         ======================================================= -->
    {% if show_categories %}
      <section class="tab-panel" data-panel="categories">
        <div class="card">
          <h2>Categories</h2>

          {% if page.categories and page.categories.size > 0 %}
            <ul class="list">
              {% for c in page.categories %}
                <li>{{ c }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="muted">No categories listed yet.</p>
          {% endif %}

          {% if page.subcategories and page.subcategories.size > 0 %}
            <hr style="border: 0; border-top: 1px solid var(--border); margin: 1rem 0;">
            <h3>Subcategories</h3>
            <ul class="list">
              {% for s in page.subcategories %}
                <li>{{ s }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </section>
    {% endif %}

    <!-- =======================================================
         COMPLETED RUNS
         ======================================================= -->
    {% if show_runs %}
      <section class="tab-panel" data-panel="runs">
        <div class="card">
          <h2>Completed Runs</h2>
          <p class="muted" id="runs-count"></p>

          <div style="margin: 0.5rem 0 0.75rem 0;">
            <label class="muted" for="runs-limit">Show:</label>
            <select id="runs-limit" class="select">
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="0">All</option>
            </select>
          </div>

          <div id="runs-list">
            {% if site.runs %}
               {% assign game_runs = site.runs | where: "game_id", page.game_id | sort: "date" | reverse %}
            {% else %}
               {% assign game_runs = empty %}
            {% endif %}

            {% for run in game_runs %}
              <article class="card run-item">
                <div class="muted" style="margin-bottom: 0.25rem;">
                  {% if run.date %}{{ run.date }}{% endif %}
                  {% if run.platform %}{% if run.date %} • {% endif %}{{ run.platform }}{% endif %}
                </div>

                <h3 style="margin: 0 0 0.35rem 0;">
                  {{ run.title | default: run.category | default: "Run" }}
                </h3>

                <p class="muted" style="margin: 0 0 0.5rem 0;">
                  {% if run.runner_name %}
                    Runner:
                    <a href="{{ '/runners/' | relative_url }}{{ run.runner_id | slugify }}/">
                      {{ run.runner_name }}
                    </a>
                  {% elsif run.runner_id %}
                    Runner:
                    <a href="{{ '/runners/' | relative_url }}{{ run.runner_id | slugify }}/">
                      {{ run.runner_id }}
                    </a>
                  {% endif %}

                  {% if run.category %}
                    {% if run.runner_id or run.runner_name %} • {% endif %}
                    Category: {{ run.category }}
                  {% endif %}

                  {% if run.challenge %}
                    • Challenge: {{ run.challenge }}
                  {% endif %}
                </p>

                {% if run.video %}
                  <p style="margin: 0;">
                    <a href="{{ run.video }}" target="_blank" rel="noopener">Watch</a>
                  </p>
                {% endif %}
              </article>
            {% endfor %}
          </div>

          <div class="pager" id="runs-pager" style="display:none; margin-top: 0.75rem;">
            <button class="btn" id="runs-prev" type="button">Prev</button>
            <span class="muted" id="runs-page" style="padding: 0 0.5rem;"></span>
            <button class="btn" id="runs-next" type="button">Next</button>
          </div>
        </div>
      </section>
    {% endif %}
       
    <!-- =======================================================
         RESOURCES
         ======================================================= -->
    {% if show_resources %}
      <section class="tab-panel" data-panel="resources">
        <div class="card">
          <h2>Resources</h2>
          <p class="muted">Coming soon.</p>
        </div>
      </section>
    {% endif %}

    <!-- =======================================================
         GUIDES
         ======================================================= -->
    {% if show_guides %}
      <section class="tab-panel" data-panel="guides">
        <div class="card">
          <h2>Guides</h2>
          <p class="muted">Coming soon.</p>
        </div>
      </section>
    {% endif %}

    <!-- =======================================================
         FORUMS
         ======================================================= -->
    {% if show_forums %}
      <section class="tab-panel" data-panel="forums">
        <div class="card">
          <h2>Forums</h2>
          <p class="muted">Coming soon.</p>
        </div>
      </section>
    {% endif %}

    <!-- =======================================================
         HISTORY
         ======================================================= -->
    {% if show_history %}
      <section class="tab-panel" data-panel="history">
        <div class="card">
          <h2>History</h2>

          {% if page.history %}
            {{ page.history | markdownify }}
          {% else %}
            <p class="muted">No history recorded yet.</p>
          {% endif %}
        </div>
      </section>
    {% endif %}

  </div>
{% endif %}

<!-- =========================================================
     Tabs Script
     ========================================================= -->
<script>
(function () {
  const root = document.getElementById("game-tabs");
  if (!root) return;

  const tabs = Array.from(root.querySelectorAll('button.tab[data-tab]'));
  const wrap = root.nextElementSibling;
  const panels = wrap ? Array.from(wrap.querySelectorAll(".tab-panel")) : [];

  function setActive(name) {
    const hasPanel = panels.some(p => p.dataset.panel === name);
    if (!hasPanel) return;

    for (const t of tabs) t.classList.toggle("active", t.dataset.tab === name);
    for (const p of panels) p.classList.toggle("active", p.dataset.panel === name);
  }

  tabs.forEach(t => {
    t.addEventListener("click", () => {
      setActive(t.dataset.tab);
      history.replaceState(null, "", "#" + t.dataset.tab);
    });
  });

  const hash = location.hash.slice(1);
  const valid = tabs.find(t => t.dataset.tab === hash);
  const start = valid ? hash : (tabs[0] && tabs[0].dataset.tab);

  if (start) setActive(start);
})();
</script>

<script>
(function () {
  const list = document.getElementById("runs-list");
  if (!list) return;

  const items = Array.from(list.querySelectorAll(".run-item"));
  const limitEl = document.getElementById("runs-limit");
  const countEl = document.getElementById("runs-count");

  const pager = document.getElementById("runs-pager");
  const prevBtn = document.getElementById("runs-prev");
  const nextBtn = document.getElementById("runs-next");
  const pageLabel = document.getElementById("runs-page");

  let page = 1;

  function getLimit() {
    const v = parseInt(limitEl.value, 10);
    return Number.isFinite(v) ? v : 10;
  }

  function render() {
    const limit = getLimit();
    const total = items.length;

    if (countEl) countEl.textContent = total === 1 ? "1 run" : `${total} runs`;

    if (limit === 0) {
      items.forEach(el => (el.style.display = ""));
      if (pager) pager.style.display = "none";
      return;
    }

    const pages = Math.max(1, Math.ceil(total / limit));
    if (page > pages) page = pages;

    const start = (page - 1) * limit;
    const end = start + limit;

    items.forEach((el, i) => {
      el.style.display = (i >= start && i < end) ? "" : "none";
    });

    if (pager) pager.style.display = pages > 1 ? "" : "none";
    if (pageLabel) pageLabel.textContent = `Page ${page} / ${pages}`;

    if (prevBtn) prevBtn.disabled = page <= 1;
    if (nextBtn) nextBtn.disabled = page >= pages;
  }

  if (prevBtn) prevBtn.addEventListener("click", () => { page -= 1; render(); });
  if (nextBtn) nextBtn.addEventListener("click", () => { page += 1; render(); });

  if (limitEl) {
    limitEl.addEventListener("change", () => {
      page = 1;
      render();
    });
  }

  render();
})();
</script>
