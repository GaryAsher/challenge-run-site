---
layout: default
---

{% assign game = site.games | where: "game_id", page.game_id | first %}

<!-- =========================================================
     Back link to the Games index
     ========================================================= -->
<div class="page-width">
  <p class="muted page-back">
    <a href="{{ '/games/' | relative_url }}">← Games</a>
  </p>
</div>

<!-- =========================================================
     Game hero section (same as _layouts/game.html)
     ========================================================= -->
{% if game and game.cover %}
  <section
    class="game-hero"
    style="
      background-image: url('{{ game.cover | relative_url }}');
      background-position: {{ game.cover_position | default: 'center' }};
    "
  >
    <div class="game-hero__overlay">
      <div class="game-hero__content">
        <h1>{{ game.name }}</h1>

        {% if game.status %}
          <p class="muted">{{ game.status }}</p>
        {% endif %}

        {% if game.tags and game.tags.size > 0 %}
          <div class="game-tags">
            {% for tag in game.tags %}
              {% assign meta = site.data.tags[tag] %}
              <span class="tag">{{ meta.label | default: tag }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{% else %}
  <div class="container">
    <h1>{{ page.game_name }}</h1>
  </div>
{% endif %}

<!-- =========================================================
     Tabs (same look, links back to the main game page)
     ========================================================= -->
{% assign tabs_cfg = game.tabs | default: {} %}
{% unless game %}{% assign tabs_cfg = {} %}{% endunless %}
{% assign show_challenges = tabs_cfg.challenges | default: true %}
{% assign show_categories = tabs_cfg.categories | default: true %}
{% assign show_runs       = tabs_cfg.runs       | default: true %}
{% assign show_resources  = tabs_cfg.resources  | default: true %}
{% assign show_guides     = tabs_cfg.guides     | default: true %}
{% assign show_forums     = tabs_cfg.forums     | default: true %}
{% assign show_history    = tabs_cfg.history    | default: true %}

<nav class="runner-tabs" id="game-tabs">
  {% if show_challenges %}
    <a class="tab" href="{{ game.url | relative_url }}#challenges">Challenges</a>
  {% endif %}

  {% if show_categories %}
    <a class="tab" href="{{ game.url | relative_url }}#categories">Categories</a>
  {% endif %}

  {% if show_runs %}
    <a class="tab active" href="{{ page.url | relative_url }}">Completed Runs</a>
  {% endif %}

  {% if show_resources %}
    <a class="tab" href="{{ game.url | relative_url }}#resources">Resources</a>
  {% endif %}

  {% if show_guides %}
    <a class="tab" href="{{ game.url | relative_url }}#guides">Guides</a>
  {% endif %}

  {% if show_forums %}
    <a class="tab" href="{{ game.url | relative_url }}#forums">Forums</a>
  {% endif %}

  {% if show_history %}
    <a class="tab" href="{{ game.url | relative_url }}#history">History</a>
  {% endif %}
</nav>

<!-- =========================================================
     Completed Runs page body
     ========================================================= -->
<div class="page-width">
  <section class="tab-panel active">

    {% if page.subtitle %}
      <div class="card">
        <p class="muted">{{ page.subtitle }}</p>
      </div>
    {% endif %}

    <div class="card">
      <h2>Completed Runs</h2>
      <p class="muted" id="runs-count"></p>

      <div id="runs-list">
        {% assign runs = site.data.runs | where: "game_id", page.game_id | sort: "date_completed" | reverse %}

        {% if runs and runs.size > 0 %}
          <div class="table-wrap">
            <table class="runs-table">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Challenge</th>
                  <th>Restrictions</th>
                  <th>Runner</th>
                  <th>Date Completed</th>
                </tr>
              </thead>

              <tbody>
                {% for run in runs %}
                  <tr
                    class="run-row"
                    data-challenge-id="{{ run.challenge_id | default: '' | downcase }}"
                    data-restriction-ids="{{ run.restriction_ids | default: empty | join: ',' | downcase }}"
                    data-category="{{ run.category | default: '' | downcase }}"
                    data-runner="{{ run.runner_id | default: run.runner | default: '' | downcase }}"
                    data-date="{{ run.date_completed | default: '' }}"
                  >
                    <td>{{ run.category | default: "" }}</td>

                    <td>
                      {% if run.challenge %}
                        <span class="tag">{{ run.challenge }}</span>
                      {% endif %}
                    </td>

                    <td>
                      {% if run.restrictions and run.restrictions.size > 0 %}
                        {% for r in run.restrictions %}
                          <span class="tag">{{ r }}</span>
                        {% endfor %}
                      {% endif %}
                    </td>

                    <td>
                      {% if run.runner_id %}
                        <a href="{{ '/runners/' | relative_url }}{{ run.runner_id | slugify }}/">
                          {{ run.runner | default: run.runner_id }}
                        </a>
                      {% else %}
                        {{ run.runner | default: "" }}
                      {% endif %}
                    </td>

                    <td>{{ run.date_completed | default: "" }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="muted">No runs have been added yet.</p>
        {% endif %}
      </div>

      <div style="margin: 0.5rem 0 0.75rem 0;">
        <label class="muted" for="runs-limit">Show:</label>
        <select id="runs-limit" class="select">
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="0">All</option>
        </select>
      </div>

      <div class="pager" id="runs-pager" style="display:none; margin-top: 0.75rem;">
        <button class="btn" id="runs-prev" type="button">Prev</button>
        <span class="muted" id="runs-page" style="padding: 0 0.5rem;"></span>
        <button class="btn" id="runs-next" type="button">Next</button>
      </div>
    </div>

  </section>
</div>

<script>
/* =========================================================
   Completed Runs – Client-side Pagination
   ========================================================= */
(function () {
  const list = document.getElementById("runs-list");
  if (!list) return;

  const items = Array.from(list.querySelectorAll(".run-row"));
  const limitEl = document.getElementById("runs-limit");
  const countEl = document.getElementById("runs-count");

  const pager = document.getElementById("runs-pager");
  const prevBtn = document.getElementById("runs-prev");
  const nextBtn = document.getElementById("runs-next");
  const pageLabel = document.getElementById("runs-page");

  let page = 1;

  function getLimit() {
    if (!limitEl) return 10;
    const v = parseInt(limitEl.value, 10);
    return Number.isFinite(v) ? v : 10;
  }

  function render() {
    const total = items.length;
    const limit = getLimit();

    if (countEl) countEl.textContent = total === 1 ? "1 run" : `${total} runs`;

    if (limit === 0) {
      items.forEach(el => (el.style.display = ""));
      if (pager) pager.style.display = "none";
      return;
    }

    const pages = Math.max(1, Math.ceil(total / limit));
    if (page > pages) page = pages;

    const start = (page - 1) * limit;
    const end = start + limit;

    items.forEach((el, i) => {
      el.style.display = (i >= start && i < end) ? "" : "none";
    });

    if (pager) pager.style.display = pages > 1 ? "" : "none";
    if (pageLabel) pageLabel.textContent = `Page ${page} / ${pages}`;

    if (prevBtn) prevBtn.disabled = page <= 1;
    if (nextBtn) nextBtn.disabled = page >= pages;
  }

  if (prevBtn) prevBtn.addEventListener("click", () => { page -= 1; render(); });
  if (nextBtn) nextBtn.addEventListener("click", () => { page += 1; render(); });

  if (limitEl) {
    limitEl.addEventListener("change", () => {
      page = 1;
      render();
    });
  }

  render();
})();
</script>
