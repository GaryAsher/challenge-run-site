---
layout: default
---

{% assign avatar = page.avatar | default: "/assets/img/site/default-runner.png" %}

{% comment %} Pre-process all runs data for this runner {% endcomment %}
{% assign cleaned = "" | split: "" %}
{% for r in site.runs %}{% if r and r.runner_id %}{% assign cleaned = cleaned | push: r %}{% endif %}{% endfor %}
{% assign rid = page.runner_id | default: "" | strip | downcase %}
{% assign all_runner_runs = cleaned | where: "runner_id", rid | sort: "date_completed" | reverse %}
{% assign games_with_runs = "" | split: "" %}
{% for r in all_runner_runs %}{% unless games_with_runs contains r.game_id %}{% assign games_with_runs = games_with_runs | push: r.game_id %}{% endunless %}{% endfor %}

{% comment %} Calculate full runs vs mini-challenge runs {% endcomment %}
{% assign full_run_count = 0 %}
{% assign mini_run_count = 0 %}
{% for r in all_runner_runs %}
  {% assign game = site.games | where: "game_id", r.game_id | first %}
  {% assign is_full_run = false %}
  {% assign is_mini_run = false %}
  
  {% comment %} Check if category_slug matches a full_run {% endcomment %}
  {% if game.full_runs %}
    {% for fr in game.full_runs %}
      {% if fr.slug == r.category_slug %}
        {% assign is_full_run = true %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
  
  {% comment %} Check if category_slug matches a mini_challenge (including nested children) {% endcomment %}
  {% unless is_full_run %}
    {% if game.mini_challenges %}
      {% for mc in game.mini_challenges %}
        {% if mc.slug == r.category_slug %}
          {% assign is_mini_run = true %}
          {% break %}
        {% endif %}
        {% if mc.children %}
          {% for child in mc.children %}
            {% if child.slug == r.category_slug %}
              {% assign is_mini_run = true %}
              {% break %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% if is_mini_run %}{% break %}{% endif %}
      {% endfor %}
    {% endif %}
  {% endunless %}
  
  {% if is_full_run %}
    {% assign full_run_count = full_run_count | plus: 1 %}
  {% elsif is_mini_run %}
    {% assign mini_run_count = mini_run_count | plus: 1 %}
  {% else %}
    {% comment %} Default to full run if category type unknown {% endcomment %}
    {% assign full_run_count = full_run_count | plus: 1 %}
  {% endif %}
{% endfor %}

<div class="page-width">
  <p class="muted mb-3">
    <a href="{{ '/runners/' | relative_url }}">‚Üê Runners</a>
    <a href="{{ '/profile/edit/' | relative_url }}" class="btn btn--small own-profile-btn" id="edit-profile-btn" hidden style="float: right;">‚úèÔ∏è Edit Profile</a>
  </p>

  <div class="live-data-notice" id="live-data-notice" hidden>
    <span>‚ú® Showing your latest profile data</span>
  </div>

  <section class="runner-top">
    <div class="runner-left">
      <div class="runner-avatar" id="runner-avatar" data-bg="{{ avatar | relative_url }}" aria-label="{{ page.runner_name }} profile picture"></div>
      <div class="runner-name">
        <h1 id="runner-display-name">{{ page.runner_name }}{% if page.pronouns %} <span class="runner-pronouns">({{ page.pronouns }})</span>{% endif %}</h1>
        {% if page.location %}<p class="runner-location muted" id="runner-location">üìç {{ page.location }}</p>{% else %}<p class="runner-location muted" id="runner-location" hidden></p>{% endif %}
        {% if page.status %}<p class="muted runner-status" id="runner-status">{{ page.status }}</p>{% else %}<p class="muted runner-status" id="runner-status" hidden></p>{% endif %}
      </div>
    </div>

    <div class="runner-right">
      <div class="runner-links" id="runner-socials">
        {% assign s = page.socials %}
        {% assign twitch_url = s.twitch | default: page.twitch %}
        {% assign youtube_url = s.youtube | default: page.youtube %}
        {% assign discord_url = s.discord | default: page.discord %}
        {% assign steam_url = s.steam | default: page.steam_id %}
        {% assign twitter_url = s.twitter | default: page.twitter %}
        {% assign bluesky_url = s.bluesky | default: page.bluesky %}
        {% assign speedrun_url = s.speedruncom | default: page.speedruncom %}
      
        {% if twitch_url and twitch_url != "" %}<a class="runner-link runner-link--twitch" href="{{ twitch_url }}" target="_blank" rel="noreferrer" title="Twitch"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/></svg><span>Twitch</span></a>{% endif %}
        {% if youtube_url and youtube_url != "" %}<a class="runner-link runner-link--youtube" href="{{ youtube_url }}" target="_blank" rel="noreferrer" title="YouTube"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg><span>YouTube</span></a>{% endif %}
        {% if discord_url and discord_url != "" %}<a class="runner-link runner-link--discord" href="{{ discord_url }}" target="_blank" rel="noreferrer" title="Discord"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286z"/></svg><span>Discord</span></a>{% endif %}
        {% if steam_url and steam_url != "" %}<a class="runner-link runner-link--steam" href="{{ steam_url }}" target="_blank" rel="noreferrer" title="Steam"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M11.979 0C5.678 0 .511 4.86.022 11.037l6.432 2.658c.545-.371 1.203-.59 1.912-.59.063 0 .125.004.188.006l2.861-4.142V8.91c0-2.495 2.028-4.524 4.524-4.524 2.494 0 4.524 2.031 4.524 4.527s-2.03 4.525-4.524 4.525h-.105l-4.076 2.911c0 .052.004.105.004.159 0 1.875-1.515 3.396-3.39 3.396-1.635 0-3.016-1.173-3.331-2.727L.436 15.27C1.862 20.307 6.486 24 11.979 24c6.627 0 11.999-5.373 11.999-12S18.605 0 11.979 0z"/></svg><span>Steam</span></a>{% endif %}
        {% if twitter_url and twitter_url != "" %}<a class="runner-link runner-link--twitter" href="{{ twitter_url }}" target="_blank" rel="noreferrer" title="X"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg><span>X</span></a>{% endif %}
        {% if bluesky_url and bluesky_url != "" %}<a class="runner-link runner-link--bluesky" href="{{ bluesky_url }}" target="_blank" rel="noreferrer" title="Bluesky"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z"/></svg><span>Bluesky</span></a>{% endif %}
        {% if speedrun_url and speedrun_url != "" %}<a class="runner-link runner-link--speedrun" href="{{ speedrun_url }}" target="_blank" rel="noreferrer" title="SRC"><svg class="social-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4.036 0A3.918 3.918 0 0 0 .12 3.916v8.247a3.918 3.918 0 0 0 3.917 3.917H6.87l.323.206 4.487 3.925v-4.13h4.356a3.918 3.918 0 0 0 3.917-3.918V3.916A3.918 3.918 0 0 0 16.036 0zm.906 3.39h2.732l1.97 4.147 2.061-4.146h2.64l-3.538 6.391v3.71H8.451V9.78Z"/></svg><span>SRC</span></a>{% endif %}
      </div>
    </div>
  </section>

  {% if page.bio and page.bio != "" %}<section class="runner-bio card" id="runner-bio-section"><h2>About</h2><p id="runner-bio">{{ page.bio }}</p></section>{% else %}<section class="runner-bio card" id="runner-bio-section" hidden><h2>About</h2><p id="runner-bio"></p></section>{% endif %}

  <nav class="runner-tabs game-tabs"><button class="tab active" data-tab="runs" type="button">Run Statistics</button><button class="tab" data-tab="achievements" type="button">Achievements</button><button class="tab" data-tab="contributions" type="button">Contributions</button></nav>

  <!-- RUNS PANEL -->
  <section class="tab-panel active" data-panel="runs">
    
    <!-- Statistics Summary Card -->
    <div class="runner-stats-card">
      <div class="runner-stat">
        <span class="runner-stat__value">{{ games_with_runs.size }}</span>
        <span class="runner-stat__label">Game{% if games_with_runs.size != 1 %}s{% endif %}</span>
      </div>
      <div class="runner-stat">
        <span class="runner-stat__value">{{ full_run_count }}</span>
        <span class="runner-stat__label">Full Run{% if full_run_count != 1 %}s{% endif %}</span>
      </div>
      <div class="runner-stat">
        <span class="runner-stat__value">{{ mini_run_count }}</span>
        <span class="runner-stat__label">Mini-Challenge{% if mini_run_count != 1 %}s{% endif %}</span>
      </div>
      <div class="runner-stat runner-stat--total">
        <span class="runner-stat__value">{{ all_runner_runs.size }}</span>
        <span class="runner-stat__label">Total</span>
      </div>
    </div>

    {% if all_runner_runs and all_runner_runs.size > 0 %}
      
      <!-- Games Grid View (default, hidden when ?game= is set) -->
      <div id="runs-games-view">
        <div class="card">
          <h2>Run History</h2>
          <p class="muted">{{ all_runner_runs.size }} run{% if all_runner_runs.size != 1 %}s{% endif %} across {{ games_with_runs.size }} game{% if games_with_runs.size != 1 %}s{% endif %}</p>
        </div>
        <div class="runner-games-grid">
          {% for game_id in games_with_runs %}
            {% assign g = site.games | where: "game_id", game_id | first %}
            {% assign game_runs = all_runner_runs | where: "game_id", game_id %}
            {% assign run_count = game_runs.size %}
            {% assign best_run = game_runs | sort: "time_primary" | first %}
            {% assign best_time = best_run.time_primary | default: best_run.time %}
            {% assign game_avatar = g.cover | default: g.avatar | default: "/assets/img/site/default-game.png" %}
            <a href="?game={{ game_id }}" class="runner-game-card card-lift" data-game-id="{{ game_id }}">
              <div class="runner-game-card__bg" data-bg="{{ game_avatar | relative_url }}"></div>
              <div class="runner-game-card__overlay">
                <div class="runner-game-card__title">{% if g %}{{ g.game_name }}{% else %}{{ game_id }}{% endif %}</div>
                <div class="runner-game-card__stats">
                  <span class="runner-game-card__count">{{ run_count }} run{% if run_count != 1 %}s{% endif %}</span>
                  {% if best_time and best_time != "" %}<span class="runner-game-card__best">Best: {{ best_time }}</span>{% endif %}
                </div>
              </div>
            </a>
          {% endfor %}
        </div>
      </div>

      <!-- Single Game Runs View (shown when ?game= is set) -->
      <div id="runs-detail-view" hidden>
        <div class="card">
          <div class="runs-detail-header">
            <a href="?" class="btn btn--small btn--outline" id="back-to-games">‚Üê All Games</a>
            <div class="runs-detail-game" id="detail-game-info">
              <div class="runs-detail-game__cover" id="detail-game-cover"></div>
              <div>
                <h2 id="detail-game-name">Game Name</h2>
                <p class="muted" id="detail-run-count">X runs</p>
              </div>
            </div>
          </div>
        </div>
        
        <div id="runs-detail-list">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Hidden data for JavaScript -->
      <script type="application/json" id="runner-runs-data">
        [{% for r in all_runner_runs %}{
          "game_id": {{ r.game_id | jsonify }},
          "category": {{ r.category | jsonify }},
          "time": {{ r.time_primary | default: r.time | jsonify }},
          "date": {{ r.date_completed | jsonify }},
          "video_url": {{ r.video_url | default: r.video | jsonify }},
          "platform": {{ r.platform | jsonify }},
          "verified": {{ r.verified | jsonify }},
          "verified_by": {{ r.verified_by | jsonify }},
          "standard_challenges": {{ r.standard_challenges | jsonify }},
          "community_challenge": {{ r.community_challenge | jsonify }},
          "restrictions": {{ r.restrictions | jsonify }}
        }{% unless forloop.last %},{% endunless %}{% endfor %}]
      </script>
      <script type="application/json" id="games-data">
        { {% for game_id in games_with_runs %}{% assign g = site.games | where: "game_id", game_id | first %}{% assign g_img = g.cover | default: g.avatar | default: "/assets/img/site/default-game.png" %}{{ game_id | jsonify }}: {
          "name": {{ g.game_name | default: game_id | jsonify }},
          "avatar": {{ g_img | relative_url | jsonify }},
          "url": {{ g.url | relative_url | jsonify }}
        }{% unless forloop.last %},{% endunless %}{% endfor %} }
      </script>

    {% else %}
      <div class="card"><p class="muted">No runs have been added yet.</p></div>
    {% endif %}
  </section>

  <!-- ACHIEVEMENTS PANEL -->
  <section class="tab-panel" data-panel="achievements">
    
    {% comment %} Get this runner's community achievement completions {% endcomment %}
    {% assign runner_completions = "" | split: "" %}
    {% for ac in site.achievements %}
      {% if ac.runner_id == page.runner_id and ac.status == 'approved' %}
        {% assign runner_completions = runner_completions | push: ac %}
      {% endif %}
    {% endfor %}
    
    <!-- Community Achievements Section -->
    <div class="card">
      <h2>üèÖ Community Achievements</h2>
      <p class="muted mb-3">Verified achievements from game communities.</p>
      
      {% if runner_completions.size > 0 %}
        <div class="community-achievements-list">
          {% for comp in runner_completions %}
            {% assign comp_game = site.games | where: "game_id", comp.game_id | first %}
            {% assign comp_ach = nil %}
            {% if comp_game.community_achievements %}
              {% for ca in comp_game.community_achievements %}
                {% if ca.slug == comp.achievement_slug %}
                  {% assign comp_ach = ca %}
                  {% break %}
                {% endif %}
              {% endfor %}
            {% endif %}
            
            <div class="community-achievement-item">
              <div class="community-achievement-item__icon">{{ comp_ach.icon | default: 'üèÜ' }}</div>
              <div class="community-achievement-item__content">
                <div class="community-achievement-item__header">
                  <h4>{{ comp_ach.title | default: comp.achievement_slug }}</h4>
                  {% if comp_ach.difficulty %}
                    <span class="difficulty difficulty--{{ comp_ach.difficulty }}">{{ comp_ach.difficulty | capitalize }}</span>
                  {% endif %}
                </div>
                <p class="muted">{{ comp_ach.description | default: '' }}</p>
                <div class="community-achievement-item__meta">
                  <a href="{{ comp_game.url | relative_url }}" class="community-achievement-item__game">{{ comp_game.game_name }}</a>
                  <span class="muted">‚Ä¢</span>
                  <span class="muted">{{ comp.date_completed }}</span>
                  <span class="muted">‚Ä¢</span>
                  <span class="verified-badge">‚úì Verified</span>
                </div>
              </div>
              {% if comp.proof_url %}
                <a href="{{ comp.proof_url }}" target="_blank" rel="noopener" class="btn btn--small">‚ñ∂ Proof</a>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state-inline">
          <p class="muted">No community achievements completed yet.</p>
        </div>
      {% endif %}
    </div>
    
    <!-- Personal Goals Section -->
    <div class="card mt-3">
      <h2>üéØ Personal Goals</h2>
      <p class="muted mb-3">Self-set challenges and personal milestones.</p>
      
      {% if page.personal_goals and page.personal_goals.size > 0 %}
        <div class="personal-goals-list" id="personal-goals-list">
          {% for goal in page.personal_goals %}
            <div class="personal-goal-item">
              <div class="personal-goal-item__icon">{{ goal.icon | default: 'üéØ' }}</div>
              <div class="personal-goal-item__content">
                <div class="personal-goal-item__header">
                  <h4>{{ goal.title }}</h4>
                  {% if goal.completed %}
                    <span class="goal-status goal-status--completed">‚úì Completed</span>
                  {% else %}
                    <span class="goal-status goal-status--progress">In Progress</span>
                  {% endif %}
                </div>
                <p class="muted">{{ goal.description }}</p>
                {% if goal.game %}<span class="personal-goal-item__game">{{ goal.game }}</span>{% endif %}
                
                {% if goal.total and goal.total > 0 %}
                  <div class="personal-goal-item__progress">
                    <div class="progress-bar">
                      <div class="progress-bar__fill" style="width: {{ goal.current | default: 0 | times: 100 | divided_by: goal.total }}%"></div>
                    </div>
                    <span class="progress-bar__text">{{ goal.current | default: 0 }} / {{ goal.total }}</span>
                  </div>
                {% endif %}
                
                {% if goal.date_completed %}
                  <span class="muted personal-goal-item__date">Completed: {{ goal.date_completed }}</span>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state-inline" id="personal-goals-empty">
          <p class="muted">No personal goals set yet.</p>
        </div>
      {% endif %}
    </div>
    
  </section>

  <!-- CONTRIBUTIONS PANEL -->
  <section class="tab-panel" data-panel="contributions">
    <div class="card"><h2>üõ†Ô∏è Community Contributions</h2><p class="muted mb-3">Tools, guides, and resources.</p>
      {% if page.contributions and page.contributions.size > 0 %}
        <div class="contributions-list" id="contributions-list">{% for c in page.contributions %}<div class="contribution-item"><div class="contribution-icon">{{ c.icon | default: 'üìÑ' }}</div><div class="contribution-info"><h4>{{ c.title }}</h4><p class="muted">{{ c.description }}</p>{% if c.url %}<a href="{{ c.url }}" target="_blank" class="contribution-link">View ‚Üí</a>{% endif %}</div><span class="contribution-type">{{ c.type | default: 'Resource' }}</span></div>{% endfor %}</div>
      {% else %}<div class="empty-state" id="contributions-empty"><span class="empty-icon">üõ†Ô∏è</span><p>No contributions listed yet.</p></div>{% endif %}
    </div>
    <div class="card mt-3"><h3>üìã Game Page Credits</h3><p class="muted mb-3">Games where this runner is credited:</p>
      {% assign credited_games = "" | split: "" %}{% assign credited_roles = "" | split: "" %}{% for g in site.games %}{% assign is_credited = false %}{% assign credit_role = "Contributor" %}{% if g.credits %}{% for c in g.credits %}{% if c.runner_id == page.runner_id %}{% assign is_credited = true %}{% assign credit_role = c.role | default: "Contributor" %}{% break %}{% endif %}{% endfor %}{% endif %}{% if g.maintainers contains page.runner_id %}{% assign is_credited = true %}{% assign credit_role = "Maintainer" %}{% endif %}{% if is_credited %}{% assign credited_games = credited_games | push: g %}{% assign credited_roles = credited_roles | push: credit_role %}{% endif %}{% endfor %}
      {% if credited_games.size > 0 %}<div class="credits-grid">{% for cg in credited_games %}<a href="{{ cg.url | relative_url }}" class="credit-game-card"><div class="credit-game-card__bg" data-bg="{{ cg.cover | relative_url }}"></div><div class="credit-game-card__overlay"><span class="credit-game-card__name">{{ cg.game_name }}</span><span class="credit-game-card__role">{{ credited_roles[forloop.index0] }}</span></div></a>{% endfor %}</div>{% else %}<p class="muted">No credits found.</p>{% endif %}
    </div>
    <div class="card mt-3"><h3>‚úÖ Run Verifications</h3>
      {% assign verified_runs = "" | split: "" %}{% for r in site.runs %}{% if r.verified_by == page.runner_id or r.verified_by == page.runner_name %}{% assign verified_runs = verified_runs | push: r %}{% endif %}{% endfor %}
      {% if verified_runs.size > 0 %}<p>Verified <strong>{{ verified_runs.size }}</strong> run{% if verified_runs.size != 1 %}s{% endif %}</p>{% else %}<p class="muted">No verifications yet.</p>{% endif %}
    </div>
  </section>
</div>

<style>
.live-data-notice{background:rgba(var(--accent-rgb,59,195,110),.1);border:1px solid var(--accent);color:var(--accent);padding:.5rem 1rem;border-radius:var(--radius-sm);margin-bottom:1rem;font-size:.85rem}.live-data-notice[hidden]{display:none}
.runner-pronouns{font-size:.8em;font-weight:400;color:var(--text-muted)}.runner-location{margin:.25rem 0 0 0;font-size:.9rem}.runner-bio{margin-bottom:1.5rem}.runner-bio h2{margin:0 0 .5rem 0;font-size:1.1rem}.runner-bio p{margin:0;line-height:1.6;white-space:pre-wrap}
.social-icon{width:16px;height:16px;flex-shrink:0}.runner-link--twitch:hover{color:#9146ff;border-color:#9146ff}.runner-link--youtube:hover{color:#ff0000;border-color:#ff0000}.runner-link--discord:hover{color:#5865f2;border-color:#5865f2}.runner-link--steam:hover{color:#00adee;border-color:#00adee}.runner-link--twitter:hover{color:#1da1f2;border-color:#1da1f2}.runner-link--bluesky:hover{color:#0085ff;border-color:#0085ff}.runner-link--speedrun:hover{color:#ffd700;border-color:#ffd700}

/* Runner Statistics Card */
.runner-stats-card{display:flex;gap:1rem;margin-bottom:1rem;padding:1rem 1.25rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg)}
.runner-stat{display:flex;flex-direction:column;align-items:center;padding:0 1rem;border-right:1px solid var(--border)}
.runner-stat:last-child{border-right:none}
.runner-stat--total{margin-left:auto;padding-left:1.5rem;border-left:2px solid var(--accent);border-right:none}
.runner-stat__value{font-size:1.75rem;font-weight:700;color:var(--accent);line-height:1}
.runner-stat__label{font-size:.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-top:.25rem}

.runner-games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:1rem}
.runner-game-card{position:relative;display:block;aspect-ratio:16/10;border-radius:var(--radius-sm);overflow:hidden;text-decoration:none;color:#fff;background:var(--surface)}
.runner-game-card__bg{position:absolute;inset:0;background-size:cover;background-position:center;transition:transform .3s ease}
.runner-game-card:hover .runner-game-card__bg{transform:scale(1.05)}
.runner-game-card__overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.85) 0%,rgba(0,0,0,.4) 50%,rgba(0,0,0,.2) 100%);display:flex;flex-direction:column;justify-content:flex-end;padding:1rem}
.runner-game-card__title{font-weight:700;font-size:1rem;line-height:1.2;text-shadow:0 1px 3px rgba(0,0,0,.5)}
.runner-game-card__stats{display:flex;gap:.75rem;margin-top:.35rem;font-size:.8rem;color:rgba(255,255,255,.8)}
.runner-game-card__count{background:rgba(255,255,255,.15);padding:.15rem .5rem;border-radius:4px}
.runner-game-card__best{color:var(--accent);font-weight:600}

/* Runs Detail View */
.runs-detail-header{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
.runs-detail-game{display:flex;align-items:center;gap:1rem;flex:1}
.runs-detail-game__cover{width:60px;height:60px;border-radius:var(--radius-sm);background-size:cover;background-position:center;flex-shrink:0}
.runs-detail-game h2{margin:0;font-size:1.25rem}
.runs-detail-game p{margin:0}

.runs-category{margin-top:1rem}
.runs-category__title{font-size:1.1rem;font-weight:600;margin:0 0 .75rem 0;padding-bottom:.5rem;border-bottom:1px solid var(--border)}
.runs-list{display:flex;flex-direction:column;gap:.5rem}

.run-row{display:flex;align-items:center;padding:.75rem 1rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);gap:1rem}
.run-row__time{font-family:var(--font-mono,monospace);font-weight:700;font-size:1.1rem;min-width:90px}
.run-row__info{flex:1;min-width:0}
.run-row__category{font-weight:600;margin-bottom:.25rem}
.run-row__meta{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.8rem;color:var(--text-muted)}
.run-row__meta .tag{font-size:.7rem;padding:.1rem .4rem}
.run-row__verified{color:#10b981}
.run-row__actions{flex-shrink:0}

.achievements-list,.contributions-list{display:flex;flex-direction:column;gap:1rem}
.achievement-item,.contribution-item{display:flex;align-items:flex-start;gap:1rem;padding:1rem;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm)}
.achievement-icon,.contribution-icon{font-size:1.5rem}
.achievement-info,.contribution-info{flex:1}
.achievement-info h4,.contribution-info h4{margin:0 0 .25rem 0;font-size:1rem}
.achievement-info p,.contribution-info p{margin:0;font-size:.85rem}
.achievement-game{display:inline-block;margin-top:.5rem;font-size:.75rem;background:var(--surface);padding:.2rem .5rem;border-radius:4px}
.achievement-status{font-size:.75rem;font-weight:600;padding:.25rem .5rem;border-radius:4px;white-space:nowrap}
.achievement-status.completed{background:#10b981;color:#fff}
.achievement-status.in-progress{background:#f59e0b;color:#000}

/* Community Achievements */
.community-achievements-list{display:flex;flex-direction:column;gap:.75rem}
.community-achievement-item{display:flex;align-items:flex-start;gap:1rem;padding:1rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm)}
.community-achievement-item__icon{font-size:1.75rem;line-height:1}
.community-achievement-item__content{flex:1;min-width:0}
.community-achievement-item__header{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap;margin-bottom:.25rem}
.community-achievement-item__header h4{margin:0;font-size:1rem}
.community-achievement-item__meta{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin-top:.5rem;font-size:.8rem}
.community-achievement-item__game{color:var(--accent);text-decoration:none}
.community-achievement-item__game:hover{text-decoration:underline}
.verified-badge{color:#10b981;font-weight:500}

/* Personal Goals */
.personal-goals-list{display:flex;flex-direction:column;gap:.75rem}
.personal-goal-item{display:flex;align-items:flex-start;gap:1rem;padding:1rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm)}
.personal-goal-item__icon{font-size:1.75rem;line-height:1}
.personal-goal-item__content{flex:1;min-width:0}
.personal-goal-item__header{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap;margin-bottom:.25rem}
.personal-goal-item__header h4{margin:0;font-size:1rem}
.personal-goal-item__game{display:inline-block;margin-top:.5rem;font-size:.75rem;background:var(--bg);padding:.2rem .5rem;border-radius:4px;color:var(--text-muted)}
.personal-goal-item__progress{margin-top:.75rem}
.personal-goal-item__date{display:block;margin-top:.5rem;font-size:.8rem}

/* Goal Status */
.goal-status{font-size:.7rem;font-weight:600;padding:.2rem .5rem;border-radius:4px;text-transform:uppercase;letter-spacing:.3px}
.goal-status--completed{background:#10b981;color:#fff}
.goal-status--progress{background:#3b82f6;color:#fff}

/* Difficulty Badges */
.difficulty{font-size:.65rem;font-weight:600;padding:.15rem .4rem;border-radius:3px;text-transform:uppercase;letter-spacing:.3px}
.difficulty--easy{background:#22c55e;color:#fff}
.difficulty--medium{background:#eab308;color:#000}
.difficulty--hard{background:#f97316;color:#fff}
.difficulty--legendary{background:linear-gradient(135deg,#8b5cf6,#ec4899);color:#fff}

/* Progress Bar */
.progress-bar{height:8px;background:var(--border);border-radius:4px;overflow:hidden}
.progress-bar__fill{height:100%;background:var(--accent);border-radius:4px;transition:width .3s ease}
.progress-bar__text{display:block;margin-top:.25rem;font-size:.75rem;color:var(--text-muted)}

/* Empty State Inline */
.empty-state-inline{padding:1rem 0}
.empty-state-inline p{margin:0}

.contribution-link{display:inline-block;margin-top:.5rem;font-size:.85rem;color:var(--accent)}
.contribution-type{font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;background:var(--surface);padding:.25rem .5rem;border-radius:4px;color:var(--text-muted)}
.credits-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:.75rem}
.credit-game-card{position:relative;display:block;aspect-ratio:16/9;border-radius:var(--radius-sm);overflow:hidden;text-decoration:none;color:#fff}
.credit-game-card__bg{position:absolute;inset:0;background-size:cover;background-position:center}
.credit-game-card__overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.8) 0%,rgba(0,0,0,.3) 100%);display:flex;flex-direction:column;justify-content:flex-end;padding:.5rem}
.credit-game-card__name{font-weight:600;font-size:.85rem;line-height:1.2}
.credit-game-card__role{font-size:.7rem;color:var(--accent)}
.empty-state{text-align:center;padding:2rem}
.empty-icon{display:block;font-size:3rem;margin-bottom:1rem;opacity:.5}
.mt-3{margin-top:1rem}.mb-3{margin-bottom:1rem}
@media(max-width:600px){
  .runner-stats-card{flex-wrap:wrap;justify-content:center}
  .runner-stat{padding:0 .75rem;min-width:70px}
  .runner-stat--total{margin-left:0;border-left:none;border-top:1px solid var(--border);padding-top:.75rem;margin-top:.5rem;width:100%;flex-direction:row;justify-content:center;gap:.5rem}
  .runner-games-grid{grid-template-columns:1fr}
  .credits-grid{grid-template-columns:repeat(2,1fr)}
  .runs-detail-header{flex-direction:column;align-items:flex-start}
  .run-row{flex-direction:column;align-items:flex-start;gap:.5rem}
  .run-row__time{min-width:auto}
  .run-row__actions{width:100%}
  .run-row__actions .btn{width:100%;text-align:center}
}
</style>

<script>
// Lazy load backgrounds
(function(){var e=document.querySelectorAll("[data-bg]");if("IntersectionObserver"in window){var o=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.style.backgroundImage="url('"+t.dataset.bg+"')";t.removeAttribute("data-bg");o.unobserve(t)}})},{rootMargin:"100px"});e.forEach(function(e){o.observe(e)})}else{e.forEach(function(e){e.style.backgroundImage="url('"+e.dataset.bg+"')"})}})();

// Tab switching
(function(){var t=Array.from(document.querySelectorAll(".runner-tabs .tab")),p=Array.from(document.querySelectorAll(".tab-panel[data-panel]"));function s(n){for(var e of t)e.classList.toggle("active",e.dataset.tab===n);for(var a of p)a.classList.toggle("active",a.dataset.panel===n)}t.forEach(function(e){e.addEventListener("click",function(){s(e.dataset.tab)})})})();

// Game filter via query parameter
(function() {
  const gamesView = document.getElementById('runs-games-view');
  const detailView = document.getElementById('runs-detail-view');
  const runsDataEl = document.getElementById('runner-runs-data');
  const gamesDataEl = document.getElementById('games-data');
  
  if (!gamesView || !detailView || !runsDataEl || !gamesDataEl) return;
  
  let runsData, gamesData;
  try {
    runsData = JSON.parse(runsDataEl.textContent);
    gamesData = JSON.parse(gamesDataEl.textContent);
  } catch (e) {
    console.error('Failed to parse runs data:', e);
    return;
  }
  
  function showGamesView() {
    gamesView.hidden = false;
    detailView.hidden = true;
  }
  
  function showDetailView(gameId) {
    const game = gamesData[gameId];
    if (!game) {
      showGamesView();
      return;
    }
    
    // Filter runs for this game
    const gameRuns = runsData.filter(r => r.game_id === gameId);
    if (gameRuns.length === 0) {
      showGamesView();
      return;
    }
    
    // Update header
    document.getElementById('detail-game-name').textContent = game.name;
    document.getElementById('detail-run-count').textContent = gameRuns.length + ' run' + (gameRuns.length !== 1 ? 's' : '');
    document.getElementById('detail-game-cover').style.backgroundImage = `url('${game.avatar}')`;
    
    // Group runs by category
    const byCategory = {};
    gameRuns.forEach(run => {
      const cat = run.category || 'Uncategorized';
      if (!byCategory[cat]) byCategory[cat] = [];
      byCategory[cat].push(run);
    });
    
    // Build HTML
    let html = '';
    for (const [category, runs] of Object.entries(byCategory)) {
      html += `<div class="card runs-category">
        <h3 class="runs-category__title">${escapeHtml(category)}</h3>
        <div class="runs-list">`;
      
      for (const run of runs) {
        const tags = [];
        if (run.standard_challenges && run.standard_challenges.length) {
          run.standard_challenges.forEach(c => tags.push(c));
        }
        if (run.community_challenge) tags.push(run.community_challenge);
        
        html += `<article class="run-row">
          <div class="run-row__time">${escapeHtml(run.time || '‚Äî')}</div>
          <div class="run-row__info">
            <div class="run-row__meta">
              ${tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('')}
              ${run.date ? `<span>${escapeHtml(run.date)}</span>` : ''}
              ${run.platform ? `<span>${escapeHtml(run.platform)}</span>` : ''}
              ${run.verified ? '<span class="run-row__verified">‚úì Verified</span>' : ''}
            </div>
          </div>
          <div class="run-row__actions">
            ${run.video_url ? `<a href="${escapeHtml(run.video_url)}" target="_blank" rel="noopener" class="btn btn--small">‚ñ∂ Watch</a>` : ''}
          </div>
        </article>`;
      }
      
      html += '</div></div>';
    }
    
    document.getElementById('runs-detail-list').innerHTML = html;
    
    gamesView.hidden = true;
    detailView.hidden = false;
  }
  
  function escapeHtml(str) {
    if (!str) return '';
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  
  function handleRoute() {
    const params = new URLSearchParams(window.location.search);
    const gameId = params.get('game');
    
    if (gameId && gamesData[gameId]) {
      showDetailView(gameId);
    } else {
      showGamesView();
    }
  }
  
  // Handle back/forward navigation
  window.addEventListener('popstate', handleRoute);
  
  // Handle game card clicks (use pushState instead of navigation)
  document.querySelectorAll('.runner-game-card[data-game-id]').forEach(card => {
    card.addEventListener('click', function(e) {
      e.preventDefault();
      const gameId = this.dataset.gameId;
      history.pushState({game: gameId}, '', '?game=' + gameId);
      showDetailView(gameId);
    });
  });
  
  // Handle back button click
  document.getElementById('back-to-games')?.addEventListener('click', function(e) {
    e.preventDefault();
    history.pushState({}, '', window.location.pathname);
    showGamesView();
  });
  
  // Initial route
  handleRoute();
})();
</script>

<script type="module">
import { CRCAuth } from '{{ "/assets/js/auth.js" | relative_url }}';

const PAGE_RUNNER_ID = '{{ page.runner_id }}';

async function loadLiveData() {
  try {
    await CRCAuth.init();
    
    if (!CRCAuth.isSignedIn()) return;
    
    const profile = CRCAuth.getProfile();
    if (!profile || profile.runner_id !== PAGE_RUNNER_ID) return;
    
    document.getElementById('edit-profile-btn').hidden = false;
    
    const supabase = CRCAuth.getSupabaseClient();
    if (!supabase) return;
    
    const { data, error } = await supabase
      .from('runner_profiles')
      .select('*')
      .eq('runner_id', PAGE_RUNNER_ID)
      .single();
    
    if (error || !data) return;
    
    document.getElementById('live-data-notice').hidden = false;
    
    const nameEl = document.getElementById('runner-display-name');
    if (nameEl && data.display_name) {
      let html = escapeHtml(data.display_name);
      if (data.pronouns) html += ` <span class="runner-pronouns">(${escapeHtml(data.pronouns)})</span>`;
      nameEl.innerHTML = html;
    }
    
    const locEl = document.getElementById('runner-location');
    if (locEl) {
      if (data.location) { locEl.textContent = 'üìç ' + data.location; locEl.hidden = false; }
      else locEl.hidden = true;
    }
    
    const statEl = document.getElementById('runner-status');
    if (statEl) {
      if (data.status_message) { statEl.textContent = data.status_message; statEl.hidden = false; }
      else statEl.hidden = true;
    }
    
    const avatarEl = document.getElementById('runner-avatar');
    if (avatarEl && data.avatar_url) avatarEl.style.backgroundImage = `url('${data.avatar_url}')`;
    
    const bioSec = document.getElementById('runner-bio-section');
    const bioEl = document.getElementById('runner-bio');
    if (bioSec && bioEl) {
      if (data.bio) { bioEl.textContent = data.bio; bioSec.hidden = false; }
      else bioSec.hidden = true;
    }
    
    console.log('[Runner] Live data loaded');
  } catch (e) {
    console.error('[Runner] Live data error:', e);
  }
}

if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', loadLiveData);
else loadLiveData();
</script>
