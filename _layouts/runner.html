---
layout: default
---

<!-- ============================================================
     Runner Avatar Source (fallback if avatar is missing)
     ============================================================ -->
{% assign avatar = page.avatar | default: "/assets/img/site/default-runner.png" %}

<!-- ============================================================
     Runner Page Content
     ============================================================ -->
<div class="page-width">
  <p class="muted mb-3">
    <a href="{{ '/runners/' | relative_url }}">← Runners</a>
  </p>

  <!-- Runner Header Row (Avatar left, Socials right) -->
  <section class="runner-top">
    <div class="runner-left">
      <div
        class="runner-avatar"
        data-bg="{{ avatar | relative_url }}"
        aria-label="{{ page.runner_name }} profile picture"
      ></div>

      <div class="runner-name">
        <h1>{{ page.runner_name }}</h1>
        {% if page.status %}
          <p class="muted runner-status">{{ page.status }}</p>
        {% endif %}
      </div>
    </div>

    <div class="runner-right">
      <div class="runner-links">
        {% if page.twitch %}
          <a class="runner-link" href="{{ page.twitch }}" target="_blank" rel="noreferrer">
            <span>Twitch</span>
          </a>
        {% endif %}

<div class="runner-links">
  {% assign s = page.socials %}

  {% if s.twitch %}
    <a class="runner-link" href="{{ s.twitch }}" target="_blank" rel="noreferrer">
      <span>Twitch</span>
    </a>
  {% endif %}

  {% if s.youtube %}
    <a class="runner-link" href="{{ s.youtube }}" target="_blank" rel="noreferrer">
      <span>YouTube</span>
    </a>
  {% endif %}

  {% if s.discord %}
    <a class="runner-link" href="{{ s.discord }}" target="_blank" rel="noreferrer">
      <span>Discord</span>
    </a>
  {% endif %}

  {% if s.steam %}
    <a class="runner-link" href="{{ s.steam }}" target="_blank" rel="noreferrer">
      <span>Steam</span>
    </a>
  {% endif %}

  {% if s.twitter %}
    <a class="runner-link" href="{{ s.twitter }}" target="_blank" rel="noreferrer">
      <span>Twitter/X</span>
    </a>
  {% endif %}

  {% if s.bluesky %}
    <a class="runner-link" href="{{ s.bluesky }}" target="_blank" rel="noreferrer">
      <span>Bluesky</span>
    </a>
  {% endif %}

  {% if s.website %}
    <a class="runner-link" href="{{ s.website }}" target="_blank" rel="noreferrer">
      <span>Website</span>
    </a>
  {% endif %}
</div>

  <!-- ============================================================
       Runner Tabs (Profile / Runs / Other)
       ============================================================ -->
  <nav class="runner-tabs game-tabs" id="runner-tabs">
    <button class="tab active" data-tab="profile" type="button">Profile</button>
    <button class="tab" data-tab="runs" type="button">Completed Runs</button>
    <button class="tab" data-tab="other" type="button">Something Else</button>
  </nav>

  <!-- ==========================================================
       PROFILE PANEL
       ========================================================== -->
  <section class="tab-panel active" data-panel="profile">
    {% if content and content != "" %}
      <div class="card">{{ content }}</div>
    {% endif %}

    {% if page.games and page.games.size > 0 %}
      <div class="card">
        <h2>Games</h2>

        <div class="grid">
          {% for gid in page.games %}
            {% assign g = site.games | where: "game_id", gid | first %}
            {% if g %}
              <a href="{{ g.url | relative_url }}" class="game-card card-lift">
                <div class="game-card__bg" data-bg="{{ g.avatar | relative_url }}"></div>
                <div class="game-card__overlay">
                  <div class="game-card__title">{{ g.game_name }}</div>
                </div>
              </a>
            {% else %}
              <div class="card">{{ gid }}</div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </section>

  <!-- ==========================================================
       RUNS PANEL
       ========================================================== -->
  <section class="tab-panel" data-panel="runs">
    {% assign cleaned = "" | split: "" %}
    {% for r in site.runs %}
      {% if r and r.runner_id %}
        {% assign cleaned = cleaned | push: r %}
      {% endif %}
    {% endfor %}

    {% assign rid = page.runner_id | default: "" | strip | downcase %}
    {% assign runs = cleaned | where: "runner_id", rid | sort: "date_completed" | reverse %}

    {% if runs and runs.size > 0 %}
      <div class="card">
        <h2>Completed Runs</h2>
        <p class="muted">{{ runs.size }} run{% if runs.size != 1 %}s{% endif %}</p>
      </div>

      <div id="runner-runs" class="list-paged" data-page-size="25">
        <div class="list-items">
          {% for r in runs %}
            {% assign g = site.games | where: "game_id", r.game_id | first %}
            {% assign r_video = r.video_url | default: r.video | default: "" %}
            {% assign r_date  = r.date_completed | default: "" %}
            {% assign r_time  = r.time | default: "" %}

            {% comment %} Build challenge labels from standard_challenges + community_challenge {% endcomment %}
            {% assign challenge_labels = "" | split: "" %}
            
            {% comment %} Process standard_challenges array {% endcomment %}
            {% if r.standard_challenges and r.standard_challenges.size > 0 %}
              {% for ch_id in r.standard_challenges %}
                {% assign ch_label = ch_id %}
                {% comment %} Check game-specific challenges_data first {% endcomment %}
                {% if g and g.challenges_data %}
                  {% for gch in g.challenges_data %}
                    {% if gch.slug == ch_id %}
                      {% assign ch_label = gch.label | default: ch_id %}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                {% endif %}
                {% comment %} Fall back to global challenges {% endcomment %}
                {% if ch_label == ch_id %}
                  {% assign chmeta = site.data.challenges[ch_id] %}
                  {% if chmeta and chmeta.label %}{% assign ch_label = chmeta.label %}{% endif %}
                {% endif %}
                {% assign challenge_labels = challenge_labels | push: ch_label %}
              {% endfor %}
            {% endif %}
            
            {% comment %} Process community_challenge {% endcomment %}
            {% if r.community_challenge and r.community_challenge != "" %}
              {% assign challenge_labels = challenge_labels | push: r.community_challenge %}
            {% endif %}
            
            {% comment %} Backwards compatibility: check old challenge_id field {% endcomment %}
            {% if challenge_labels.size == 0 and r.challenge_id %}
              {% assign ch_id = r.challenge_id | strip %}
              {% assign ch_label = ch_id %}
              {% if g and g.challenges_data %}
                {% for gch in g.challenges_data %}
                  {% if gch.slug == ch_id %}
                    {% assign ch_label = gch.label | default: ch_id %}
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endif %}
              {% if ch_label == ch_id %}
                {% assign chmeta = site.data.challenges[ch_id] %}
                {% if chmeta and chmeta.label %}{% assign ch_label = chmeta.label %}{% endif %}
              {% endif %}
              {% assign challenge_labels = challenge_labels | push: ch_label %}
            {% endif %}

            {% assign r_texts = "" | split: "" %}
            {% if r.restrictions and r.restrictions != empty %}
              {% if r.restrictions.first %}
                {% assign r_texts = r.restrictions %}
              {% elsif r.restrictions != "[]" and r.restrictions != "" %}
                {% assign r_texts = r.restrictions | split: "," %}
              {% endif %}
            {% endif %}

            {% assign r_clean = "" | split: "" %}
            {% for rr in r_texts %}
              {% assign t = rr | strip %}
              {% if t != "" and t != "[]" %}
                {% assign r_clean = r_clean | push: t %}
              {% endif %}
            {% endfor %}
            {% assign r_texts = r_clean | uniq %}

            <article class="card list-item">
              <strong>
                {% if g %}
                  <a href="{{ g.url | relative_url }}">{{ g.game_name }}</a>
                {% else %}
                  {{ r.game_id }}
                {% endif %}
              </strong>

              {% if r.category and r.category != "" %}
                <span class="muted"> · {{ r.category }}</span>
              {% endif %}

              <div class="muted runner-run-meta">
                {% if challenge_labels and challenge_labels.size > 0 %}
                  {% for ch_lbl in challenge_labels %}
                    <span class="tag">{{ ch_lbl }}</span>
                  {% endfor %}
                {% endif %}

                {% if r_time != "" %}
                  <span class="muted"> · {{ r_time }}</span>
                {% endif %}

                {% if r_date != "" %}
                  <span class="muted"> · <time datetime="{{ r_date }}">{{ r_date }}</time></span>
                {% endif %}

                {% if r_video != "" %}
                  <span class="muted"> · <a href="{{ r_video }}" target="_blank" rel="noopener">Video</a></span>
                {% endif %}

                {% if r.verified_by and r.verified_by != "" %}
                  <span class="muted"> · Verified by {{ r.verified_by }}</span>
                {% endif %}
              </div>

              {% if r_texts and r_texts.size > 0 %}
                <div class="runner-run-tags">
                  {% for x in r_texts %}
                    <span class="tag">{{ x }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </article>
          {% endfor %}
        </div>

        <div class="list-controls list-controls--bottom">
          <div class="pager">
            <button type="button" class="btn" data-prev>Prev</button>
            <div class="page-numbers" data-pages></div>
            <button type="button" class="btn" data-next>Next</button>
            <span class="muted pager-label" data-page-label></span>
          </div>
          <div class="muted" data-status></div>
        </div>
      </div>
    {% else %}
      <div class="card">
        <p class="muted">No runs have been added yet.</p>
      </div>
    {% endif %}
  </section>

  <!-- ==========================================================
       OTHER PANEL
       ========================================================== -->
  <section class="tab-panel" data-panel="other">
    <div class="card">
      <h2>Something Else</h2>
      <p class="muted">Placeholder tab.</p>
    </div>
  </section>
</div>

<!-- ============================================================
     Tabs Script (switch panels without changing pages)
     ============================================================ -->
<script>
// Lazy Load Background Images
(function() {
  const lazyBgs = document.querySelectorAll('[data-bg]');
  
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          const el = entry.target;
          el.style.backgroundImage = "url('" + el.dataset.bg + "')";
          el.removeAttribute('data-bg');
          observer.unobserve(el);
        }
      });
    }, { rootMargin: '100px' });
    
    lazyBgs.forEach(function(el) { observer.observe(el); });
  } else {
    lazyBgs.forEach(function(el) {
      el.style.backgroundImage = "url('" + el.dataset.bg + "')";
    });
  }
})();

// Tab switching
(function () {
  const tabs = Array.from(document.querySelectorAll(".runner-tabs .tab"));
  const panels = Array.from(document.querySelectorAll(".tab-panel[data-panel]"));

  function setActive(name) {
    for (const t of tabs) t.classList.toggle("active", t.dataset.tab === name);
    for (const p of panels) p.classList.toggle("active", p.dataset.panel === name);
  }

  tabs.forEach(t => {
    t.addEventListener("click", () => setActive(t.dataset.tab));
  });
})();
</script>
