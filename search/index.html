---
layout: default
title: Search
---

<div class="page-width search-page">
  
  <div class="search-hero">
    <h1>üîç Search</h1>
    <p class="muted">Search across games, runners, runs, and news.</p>
  </div>

  <div class="search-input-wrap">
    <input 
      type="text" 
      id="search-input" 
      class="search-input" 
      placeholder="Search for anything..." 
      autocomplete="off"
      autofocus
    />
  </div>

  <div class="search-filters">
    <button type="button" class="search-filter-btn is-active" data-filter="all">All</button>
    <button type="button" class="search-filter-btn" data-filter="games">Games</button>
    <button type="button" class="search-filter-btn" data-filter="runners">Runners</button>
    <button type="button" class="search-filter-btn" data-filter="runs">Runs</button>
    <button type="button" class="search-filter-btn" data-filter="news">News</button>
  </div>

  <div class="search-results" id="search-results">
    <div class="search-no-results" id="search-empty">
      <p>Start typing to search...</p>
    </div>
  </div>

</div>

<script>
(function() {
  'use strict';

  // Build search index from Jekyll data
  var searchData = {
    games: [
      {% for g in site.games %}
      {
        type: 'game',
        name: {{ g.name | jsonify }},
        url: {{ g.url | relative_url | jsonify }},
        genres: {{ g.genres | default: empty | jsonify }},
        platforms: {{ g.platforms | default: empty | jsonify }},
        challenges: {{ g.challenges | default: empty | jsonify }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    runners: [
      {% for r in site.runners %}
      {
        type: 'runner',
        name: {{ r.display_name | default: r.runner_id | default: r.title | jsonify }},
        url: {{ r.url | relative_url | jsonify }},
        runner_id: {{ r.runner_id | default: '' | jsonify }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    runs: [
      {% for r in site.runs %}
      {
        type: 'run',
        runner: {{ r.runner | default: r.runner_id | jsonify }},
        game: {{ r.game_id | jsonify }},
        challenge: {{ r.challenge_id | jsonify }},
        category: {{ r.category | default: r.category_slug | jsonify }},
        date: {{ r.date_completed | jsonify }},
        url: '/games/{{ r.game_id }}/runs/'
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    news: [
      {% for p in site.posts %}
      {
        type: 'news',
        title: {{ p.title | jsonify }},
        url: {{ p.url | relative_url | jsonify }},
        date: {{ p.date | date: "%Y-%m-%d" | jsonify }},
        excerpt: {{ p.excerpt | strip_html | truncate: 100 | jsonify }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  };

  var input = document.getElementById('search-input');
  var resultsEl = document.getElementById('search-results');
  var emptyEl = document.getElementById('search-empty');
  var filterBtns = document.querySelectorAll('.search-filter-btn');
  var activeFilter = 'all';

  function norm(s) {
    return (s || '').toString().trim().toLowerCase();
  }

  function search(query) {
    var q = norm(query);
    if (!q) {
      resultsEl.innerHTML = '';
      resultsEl.appendChild(emptyEl);
      emptyEl.innerHTML = '<p>Start typing to search...</p>';
      return;
    }

    var results = {
      games: [],
      runners: [],
      runs: [],
      news: []
    };

    // Search games
    if (activeFilter === 'all' || activeFilter === 'games') {
      searchData.games.forEach(function(g) {
        if (norm(g.name).includes(q)) {
          results.games.push(g);
        }
      });
    }

    // Search runners
    if (activeFilter === 'all' || activeFilter === 'runners') {
      searchData.runners.forEach(function(r) {
        if (norm(r.name).includes(q) || norm(r.runner_id).includes(q)) {
          results.runners.push(r);
        }
      });
    }

    // Search runs
    if (activeFilter === 'all' || activeFilter === 'runs') {
      searchData.runs.forEach(function(r) {
        if (norm(r.runner).includes(q) || norm(r.game).includes(q) || 
            norm(r.challenge).includes(q) || norm(r.category).includes(q)) {
          results.runs.push(r);
        }
      });
    }

    // Search news
    if (activeFilter === 'all' || activeFilter === 'news') {
      searchData.news.forEach(function(n) {
        if (norm(n.title).includes(q) || norm(n.excerpt).includes(q)) {
          results.news.push(n);
        }
      });
    }

    renderResults(results, q);
  }

  function renderResults(results, query) {
    var totalResults = results.games.length + results.runners.length + 
                       results.runs.length + results.news.length;

    if (totalResults === 0) {
      resultsEl.innerHTML = '';
      emptyEl.innerHTML = '<p>No results found for "<strong>' + escapeHtml(query) + '</strong>"</p>';
      resultsEl.appendChild(emptyEl);
      return;
    }

    var html = '';

    // Games
    if (results.games.length > 0) {
      html += '<div class="search-result-group">';
      html += '<h2>üéÆ Games (' + results.games.length + ')</h2>';
      results.games.forEach(function(g) {
        html += '<a href="' + g.url + '" class="search-result">';
        html += '<div class="search-result__title">' + escapeHtml(g.name) + '</div>';
        if (g.genres && g.genres.length) {
          html += '<div class="search-result__meta">' + g.genres.slice(0, 3).join(', ') + '</div>';
        }
        html += '</a>';
      });
      html += '</div>';
    }

    // Runners
    if (results.runners.length > 0) {
      html += '<div class="search-result-group">';
      html += '<h2>üèÜ Runners (' + results.runners.length + ')</h2>';
      results.runners.forEach(function(r) {
        html += '<a href="' + r.url + '" class="search-result">';
        html += '<div class="search-result__title">' + escapeHtml(r.name) + '</div>';
        html += '</a>';
      });
      html += '</div>';
    }

    // Runs
    if (results.runs.length > 0) {
      html += '<div class="search-result-group">';
      html += '<h2>üèÉ Runs (' + results.runs.length + ')</h2>';
      results.runs.slice(0, 20).forEach(function(r) {
        html += '<a href="' + r.url + '" class="search-result">';
        html += '<div class="search-result__title">' + escapeHtml(r.runner) + ' - ' + escapeHtml(r.game) + '</div>';
        html += '<div class="search-result__meta">' + escapeHtml(r.challenge) + ' ‚Ä¢ ' + escapeHtml(r.category) + '</div>';
        html += '</a>';
      });
      if (results.runs.length > 20) {
        html += '<p class="muted" style="padding: 0.5rem;">...and ' + (results.runs.length - 20) + ' more</p>';
      }
      html += '</div>';
    }

    // News
    if (results.news.length > 0) {
      html += '<div class="search-result-group">';
      html += '<h2>üì∞ News (' + results.news.length + ')</h2>';
      results.news.forEach(function(n) {
        html += '<a href="' + n.url + '" class="search-result">';
        html += '<div class="search-result__title">' + escapeHtml(n.title) + '</div>';
        html += '<div class="search-result__meta">' + n.date + '</div>';
        html += '</a>';
      });
      html += '</div>';
    }

    resultsEl.innerHTML = html;
  }

  function escapeHtml(str) {
    var div = document.createElement('div');
    div.textContent = str || '';
    return div.innerHTML;
  }

  // Event listeners
  var debounceTimer;
  input.addEventListener('input', function() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(function() {
      search(input.value);
    }, 150);
  });

  filterBtns.forEach(function(btn) {
    btn.addEventListener('click', function() {
      filterBtns.forEach(function(b) { b.classList.remove('is-active'); });
      btn.classList.add('is-active');
      activeFilter = btn.dataset.filter;
      search(input.value);
    });
  });

  // Check for query param
  var urlParams = new URLSearchParams(window.location.search);
  var initialQuery = urlParams.get('q');
  if (initialQuery) {
    input.value = initialQuery;
    search(initialQuery);
  }
})();
</script>
