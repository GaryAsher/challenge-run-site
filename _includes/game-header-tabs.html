{% assign game = include.game | default: page %}

{% if game %}

{% assign tabs = game.tabs %}

<!-- =========================================================
     Tab order:
     - Overview (always)
     - Runs (always)
     - History (main)
     - Challenges (optional)
     - Guides (optional)
     - Resources (optional)
     - Rules (optional)
     - Forum (optional placeholder)
     - Extra 1 (optional placeholder)
     - Extra 2 (optional placeholder)
     ========================================================= -->

<!-- =========================================================
     Back link
     ========================================================= -->
<div class="page-width">
  <p class="muted page-back">
    <a href="{{ '/games/' | relative_url }}">‚Üê Games</a>
  </p>
</div>

<!-- =========================================================
     Game hero
     ========================================================= -->
{% if game.cover %}
  <div class="page-width">
    <div class="game-shell">
      <section
        class="game-hero"
        style="
          background-image: url('{{ game.cover | relative_url }}');
          background-position: {{ game.cover_position | default: 'center' }};
        "
      >
        <div class="game-hero__overlay">
          <div class="game-hero__content">
            <h1>{{ game.name }}</h1>

            {% if game.status %}
              <p class="muted">{{ game.status }}</p>
            {% endif %}

            {% if game.tags and game.tags.size > 0 %}
              <div class="game-tags">
                {% for tag in game.tags %}
                  {% assign meta = site.data.tags[tag] %}
                  <span class="tag">{{ meta.label | default: tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </section>
    </div>
  </div>
{% else %}
  <div class="page-width">
    <div class="game-shell">
      <h1>{{ game.name }}</h1>

      {% if game.status %}
        <p class="muted">{{ game.status }}</p>
      {% endif %}

      {% if game.tags and game.tags.size > 0 %}
        <div class="game-tags">
          {% for tag in game.tags %}
            {% assign meta = site.data.tags[tag] %}
            <span class="tag">{{ meta.label | default: tag }}</span>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}

<!-- =========================================================
     Game tabs
     ========================================================= -->
<div class="page-width">
  <div class="game-shell">
    <nav class="runner-tabs game-tabs" id="game-tabs">

      <!-- Overview (always) -->
      <a
        class="tab {% if include.active == 'overview' %}active{% endif %}"
        data-tab="overview"
        href="{{ game.url | relative_url }}"
        data-href="{{ game.url | relative_url }}"
      >
        Overview
      </a>

      <!-- Runs (always) -->
      <a
        class="tab {% if include.active == 'runs' %}active{% endif %}"
        data-tab="runs"
        href="{{ game.url | relative_url }}runs/"
        data-href="{{ game.url | relative_url }}runs/"
      >
        Runs
      </a>

      <!-- History -->
      {% if tabs and tabs.history %}
        <a
          class="tab {% if include.active == 'history' %}active{% endif %}"
          data-tab="history"
          href="{{ game.url | relative_url }}history/"
          data-href="{{ game.url | relative_url }}history/"
        >
          History
        </a>
      {% endif %}

      <!-- Optional tabs -->
      {% if tabs and tabs.challenges %}
        <a
          class="tab {% if include.active == 'challenges' %}active{% endif %}"
          data-tab="challenges"
          href="{{ game.url | relative_url }}challenges/"
          data-href="{{ game.url | relative_url }}challenges/"
        >
          Challenges
        </a>
      {% endif %}

      {% if tabs and tabs.guides %}
        <a
          class="tab {% if include.active == 'guides' %}active{% endif %}"
          data-tab="guides"
          href="{{ game.url | relative_url }}guides/"
          data-href="{{ game.url | relative_url }}guides/"
        >
          Guides
        </a>
      {% endif %}

      {% if tabs and tabs.resources %}
        <a
          class="tab {% if include.active == 'resources' %}active{% endif %}"
          data-tab="resources"
          href="{{ game.url | relative_url }}resources/"
          data-href="{{ game.url | relative_url }}resources/"
        >
          Resources
        </a>
      {% endif %}

      {% if tabs and tabs.rules %}
        <a
          class="tab {% if include.active == 'rules' %}active{% endif %}"
          data-tab="rules"
          href="{{ game.url | relative_url }}rules/"
          data-href="{{ game.url | relative_url }}rules/"
        >
          Rules
        </a>
      {% endif %}

      {% if tabs and tabs.forum %}
        <a
          class="tab {% if include.active == 'forum' %}active{% endif %}"
          data-tab="forum"
          href="{{ game.url | relative_url }}forum/"
          data-href="{{ game.url | relative_url }}forum/"
        >
          Forum
        </a>
      {% endif %}

      <!-- Future placeholders -->
      {% if tabs and tabs.extra_1 %}
        <a
          class="tab {% if include.active == 'extra-1' %}active{% endif %}"
          data-tab="extra-1"
          href="{{ game.url | relative_url }}extra-1/"
          data-href="{{ game.url | relative_url }}extra-1/"
        >
          {{ game.extra_1_label | default: "Extra" }}
        </a>
      {% endif %}

      {% if tabs and tabs.extra_2 %}
        <a
          class="tab {% if include.active == 'extra-2' %}active{% endif %}"
          data-tab="extra-2"
          href="{{ game.url | relative_url }}extra-2/"
          data-href="{{ game.url | relative_url }}extra-2/"
        >
          {{ game.extra_2_label | default: "Extra 2" }}
        </a>
      {% endif %}

    </nav>
  </div>
</div>

{% else %}

<div class="page-width">
  <div class="card">
    <p class="muted">Error: game context missing for this page.</p>
  </div>
</div>

{% endif %}
