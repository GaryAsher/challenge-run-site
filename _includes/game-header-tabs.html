{% assign game = include.game | default: page %}

{% if game %}

{% assign tabs = game.tabs %}

<!-- =========================================================
     Back link
     ========================================================= -->
<div class="page-width">
  <p class="muted page-back">
    <a href="{{ '/games/' | relative_url }}">‚Üê Games</a>
  </p>
</div>

<!-- =========================================================
     Game hero
     ========================================================= -->
{% if game.cover %}
  <div class="page-width">
    <div class="game-shell">
      <section
        class="game-hero{% if include.active == 'overview' %} game-hero--active{% endif %}"
        style="
          background-image: url('{{ game.cover | relative_url }}');
          background-position: {{ game.cover_position | default: 'center' }};
        "
      >
        <div class="game-hero__overlay">
          <div class="game-hero__content">
            <h1>{{ game.game_name }}</h1>

            {% if game.genres and game.genres.size > 0 %}
              <div class="game-genres">
                {% for tag in game.genres %}
                  {% assign meta = site.data.genres[tag] %}
                  <span class="tag">{{ meta.label | default: tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          {% if game.platforms and game.platforms.size > 0 %}
          <div class="game-hero__platforms">
            {% for plat in game.platforms %}
              {% assign plat_meta = site.data.platforms[plat] %}
              <span class="tag tag--platform">{{ plat_meta.label | default: plat }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </section>
    </div>
  </div>
{% else %}
  <div class="page-width">
    <div class="game-shell">
      <h1>{{ game.game_name }}</h1>

      {% if game.status %}
        <p class="muted">{{ game.status }}</p>
      {% endif %}

      {% if game.genres and game.genres.size > 0 %}
        <div class="game-genres">
          {% for tag in game.genres %}
            {% assign meta = site.data.genres[tag] %}
            <span class="tag">{{ meta.label | default: tag }}</span>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}

<!-- =========================================================
     Game tabs - Order: Overview -> Runs -> Rules -> Resources -> History -> Forum
     ========================================================= -->
<div class="page-width">
  <div class="game-shell">
    <nav class="runner-tabs game-tabs" id="game-tabs">

      <!-- Overview (always) -->
      <a
        class="tab {% if include.active == 'overview' %}active{% endif %}"
        data-tab="overview"
        href="{{ game.url | relative_url }}"
        data-href="{{ game.url | relative_url }}"
      >
        Overview
      </a>

      <!-- Runs (always) -->
      <a
        class="tab {% if include.active == 'runs' %}active{% endif %}"
        data-tab="runs"
        href="{{ game.url | relative_url }}runs/"
        data-href="{{ game.url | relative_url }}runs/"
      >
        Runs
      </a>

      <!-- Rules (always) -->
      <a
        class="tab {% if include.active == 'rules' %}active{% endif %}"
        data-tab="rules"
        href="{{ game.url | relative_url }}rules/"
        data-href="{{ game.url | relative_url }}rules/"
      >
        Rules
      </a>

      <!-- Resources -->
      {% if tabs and tabs.resources %}
        <a
          class="tab {% if include.active == 'resources' %}active{% endif %}"
          data-tab="resources"
          href="{{ game.url | relative_url }}resources/"
          data-href="{{ game.url | relative_url }}resources/"
        >
          Resources
        </a>
      {% endif %}

      <!-- History -->
      {% if tabs and tabs.history %}
        <a
          class="tab {% if include.active == 'history' %}active{% endif %}"
          data-tab="history"
          href="{{ game.url | relative_url }}history/"
          data-href="{{ game.url | relative_url }}history/"
        >
          History
        </a>
      {% endif %}

      <!-- Forum -->
      {% if tabs and tabs.forum %}
        <a
          class="tab {% if include.active == 'forum' %}active{% endif %}"
          data-tab="forum"
          href="{{ game.url | relative_url }}forum/"
          data-href="{{ game.url | relative_url }}forum/"
        >
          Forum
        </a>
      {% endif %}

      <!-- Submit Run (always shown) -->
      <a
        class="tab tab--submit {% if include.active == 'submit' %}active{% endif %}"
        data-tab="submit"
        href="{{ game.url | relative_url }}submit/"
        data-href="{{ game.url | relative_url }}submit/"
      >
        Submit Run
      </a>

    </nav>
  </div>
</div>

{% else %}

<div class="page-width">
  <div class="card">
    <p class="muted">Error: game context missing for this page.</p>
  </div>
</div>

{% endif %}
