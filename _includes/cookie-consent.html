<!-- Cookie Consent Banner -->
<div class="cookie-consent" id="cookie-consent" hidden>
  <div class="cookie-consent__content">
    <div class="cookie-consent__text">
      <h3>üç™ Cookie Notice</h3>
      <p>
        We use cookies to keep you signed in and remember your preferences. 
        We do not sell your personal information.
        <a href="/legal/privacy/">Learn more</a>
      </p>
    </div>
    <div class="cookie-consent__actions">
      <button type="button" class="btn btn--small" id="cookie-settings-btn">Customize</button>
      <button type="button" class="btn btn--small btn--primary" id="cookie-accept-btn">Accept All</button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div class="cookie-modal" id="cookie-modal" hidden>
  <div class="cookie-modal__backdrop" id="cookie-modal-backdrop"></div>
  <div class="cookie-modal__content">
    <div class="cookie-modal__header">
      <h2>Cookie Preferences</h2>
      <button type="button" class="cookie-modal__close" id="cookie-modal-close">&times;</button>
    </div>
    <div class="cookie-modal__body">
      <p class="muted mb-3">
        Choose which cookies you allow. You can change these settings at any time from the footer.
      </p>
      
      <!-- Essential Cookies -->
      <div class="cookie-category">
        <div class="cookie-category__header">
          <div class="cookie-category__info">
            <h4>Essential Cookies</h4>
            <p>Required for the website to function. Cannot be disabled.</p>
          </div>
          <div class="cookie-toggle cookie-toggle--disabled">
            <span class="cookie-toggle__label">Always On</span>
          </div>
        </div>
      </div>
      
      <!-- Preference Cookies -->
      <div class="cookie-category">
        <div class="cookie-category__header">
          <div class="cookie-category__info">
            <h4>Preference Cookies</h4>
            <p>Remember your settings like theme, language, and display preferences.</p>
          </div>
          <label class="cookie-toggle">
            <input type="checkbox" id="cookie-preferences" checked />
            <span class="cookie-toggle__switch"></span>
          </label>
        </div>
      </div>
      
      <!-- Analytics Cookies -->
      <div class="cookie-category">
        <div class="cookie-category__header">
          <div class="cookie-category__info">
            <h4>Analytics Cookies</h4>
            <p>Help us understand how visitors use the site (anonymized).</p>
          </div>
          <label class="cookie-toggle">
            <input type="checkbox" id="cookie-analytics" />
            <span class="cookie-toggle__switch"></span>
          </label>
        </div>
      </div>
      
      <div class="cookie-info-box">
        <p><strong>We do not sell your data.</strong></p>
        <p>
          California residents: You have the right to opt out of the sale of personal information. 
          Since we don't sell data, no action is needed. 
          <a href="/legal/privacy/#your-rights">Learn about your rights</a>
        </p>
      </div>
    </div>
    <div class="cookie-modal__footer">
      <button type="button" class="btn" id="cookie-reject-all">Reject Non-Essential</button>
      <button type="button" class="btn btn--primary" id="cookie-save-settings">Save Preferences</button>
    </div>
  </div>
</div>

<style>
/* Cookie Consent Banner */
.cookie-consent {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 999;
  background: var(--surface);
  border-top: 1px solid var(--border);
  box-shadow: 0 -4px 12px rgba(0,0,0,0.2);
  padding: 1rem;
}

.cookie-consent[hidden] { display: none; }

.cookie-consent__content {
  max-width: var(--page-max);
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.cookie-consent__text {
  flex: 1;
  min-width: 280px;
}

.cookie-consent__text h3 {
  font-size: 1rem;
  margin-bottom: 0.25rem;
}

.cookie-consent__text p {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin: 0;
}

.cookie-consent__text a {
  color: var(--accent);
}

.cookie-consent__actions {
  display: flex;
  gap: 0.5rem;
  flex-shrink: 0;
}

.btn--small {
  padding: 0.5rem 1rem;
  font-size: 0.85rem;
}

/* Cookie Modal */
.cookie-modal {
  position: fixed;
  inset: 0;
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.cookie-modal[hidden] { display: none; }

.cookie-modal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
}

.cookie-modal__content {
  position: relative;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  animation: modalSlideIn 0.2s ease;
}

@keyframes modalSlideIn {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.cookie-modal__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
}

.cookie-modal__header h2 {
  font-size: 1.1rem;
  margin: 0;
}

.cookie-modal__close {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: var(--text-muted);
  cursor: pointer;
  padding: 0.25rem;
  line-height: 1;
}

.cookie-modal__body {
  padding: 1.25rem;
  overflow-y: auto;
  flex: 1;
}

.cookie-modal__footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border);
  background: var(--bg);
}

/* Cookie Categories */
.cookie-category {
  padding: 1rem 0;
  border-bottom: 1px solid var(--border);
}

.cookie-category:last-of-type {
  border-bottom: none;
}

.cookie-category__header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
}

.cookie-category__info {
  flex: 1;
}

.cookie-category__info h4 {
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
}

.cookie-category__info p {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin: 0;
}

/* Cookie Toggle */
.cookie-toggle {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.cookie-toggle--disabled {
  cursor: default;
}

.cookie-toggle__label {
  font-size: 0.75rem;
  color: var(--text-muted);
  background: var(--bg);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
}

.cookie-toggle input {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.cookie-toggle__switch {
  position: relative;
  width: 44px;
  height: 24px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  transition: all 0.2s ease;
}

.cookie-toggle__switch::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 18px;
  height: 18px;
  background: var(--text-muted);
  border-radius: 50%;
  transition: all 0.2s ease;
}

.cookie-toggle input:checked + .cookie-toggle__switch {
  background: var(--accent);
  border-color: var(--accent);
}

.cookie-toggle input:checked + .cookie-toggle__switch::after {
  left: 22px;
  background: var(--bg);
}

/* Info Box */
.cookie-info-box {
  margin-top: 1rem;
  padding: 1rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 0.85rem;
}

.cookie-info-box p {
  margin: 0 0 0.5rem 0;
  color: var(--text-muted);
}

.cookie-info-box p:last-child {
  margin-bottom: 0;
}

.cookie-info-box a {
  color: var(--accent);
}
</style>

<script>
(function() {
  const CONSENT_KEY = 'crc-cookie-consent';
  const banner = document.getElementById('cookie-consent');
  const modal = document.getElementById('cookie-modal');
  
  // Check if consent already given
  const consent = localStorage.getItem(CONSENT_KEY);
  if (!consent) {
    banner.hidden = false;
  }
  
  // Accept all
  document.getElementById('cookie-accept-btn')?.addEventListener('click', function() {
    saveConsent({ essential: true, preferences: true, analytics: true });
    banner.hidden = true;
  });
  
  // Open settings
  document.getElementById('cookie-settings-btn')?.addEventListener('click', function() {
    modal.hidden = false;
    loadCurrentSettings();
  });
  
  // Close modal
  document.getElementById('cookie-modal-close')?.addEventListener('click', function() {
    modal.hidden = true;
  });
  document.getElementById('cookie-modal-backdrop')?.addEventListener('click', function() {
    modal.hidden = true;
  });
  
  // Reject non-essential
  document.getElementById('cookie-reject-all')?.addEventListener('click', function() {
    document.getElementById('cookie-preferences').checked = false;
    document.getElementById('cookie-analytics').checked = false;
    saveConsent({ essential: true, preferences: false, analytics: false });
    modal.hidden = true;
    banner.hidden = true;
  });
  
  // Save settings
  document.getElementById('cookie-save-settings')?.addEventListener('click', function() {
    saveConsent({
      essential: true,
      preferences: document.getElementById('cookie-preferences').checked,
      analytics: document.getElementById('cookie-analytics').checked
    });
    modal.hidden = true;
    banner.hidden = true;
  });
  
  function saveConsent(settings) {
    const data = {
      ...settings,
      timestamp: new Date().toISOString(),
      version: '1.0'
    };
    localStorage.setItem(CONSENT_KEY, JSON.stringify(data));
    
    // Apply settings
    applyConsent(settings);
  }
  
  function loadCurrentSettings() {
    const consent = localStorage.getItem(CONSENT_KEY);
    if (consent) {
      try {
        const data = JSON.parse(consent);
        document.getElementById('cookie-preferences').checked = data.preferences !== false;
        document.getElementById('cookie-analytics').checked = data.analytics === true;
      } catch (e) {}
    }
  }
  
  function applyConsent(settings) {
    // This is where you'd enable/disable analytics, etc.
    // For now, we just store the preference
    
    // Example: Enable/disable Google Analytics
    if (settings.analytics && typeof gtag === 'function') {
      gtag('consent', 'update', {
        'analytics_storage': 'granted'
      });
    }
    
    console.log('[Cookies] Consent saved:', settings);
  }
  
  // Expose for footer link
  window.CRCCookieConsent = {
    showSettings: function() {
      modal.hidden = false;
      loadCurrentSettings();
    }
  };
  
  // Apply existing consent on load
  if (consent) {
    try {
      applyConsent(JSON.parse(consent));
    } catch (e) {}
  }
})();
</script>
